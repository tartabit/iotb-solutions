{
  "templateDef": [
    {
      "name": "UDP Port",
      "key": "port",
      "desc": "Use 9120 for shared port, or open a support request to have a port assigned.",
      "value": "9120"
    }
  ],
  "dashboards": [
    {
      "id": "683dfd6ad004d627f9f96b17",
      "name": "Queclink Dashboard",
      "scope": "account",
      "view": {
        "layout": [
          {
            "h": 3,
            "i": "widget-1748893224225",
            "moved": false,
            "static": false,
            "w": 2,
            "x": 0,
            "y": 0
          },
          {
            "h": 6,
            "i": "widget-1748893281351",
            "moved": false,
            "static": false,
            "w": 4,
            "x": 0,
            "y": 6
          },
          {
            "h": 3,
            "i": "widget-1748893320108",
            "moved": false,
            "static": false,
            "w": 4,
            "x": 4,
            "y": 0
          },
          {
            "h": 3,
            "i": "widget-1748893585479",
            "moved": false,
            "static": false,
            "w": 4,
            "x": 4,
            "y": 9
          },
          {
            "h": 9,
            "i": "widget-1748894265469",
            "moved": false,
            "static": false,
            "w": 4,
            "x": 8,
            "y": 0
          },
          {
            "h": 3,
            "i": "widget-1749522549574",
            "moved": false,
            "static": false,
            "w": 4,
            "x": 4,
            "y": 6
          },
          {
            "h": 3,
            "i": "widget-1766073184636",
            "moved": false,
            "static": false,
            "w": 4,
            "x": 0,
            "y": 3
          },
          {
            "h": 3,
            "i": "widget-1766073238581",
            "moved": false,
            "static": false,
            "w": 4,
            "x": 4,
            "y": 3
          }
        ]
      },
      "widgets": {
        "widget-1748893224225": {
          "config": {
            "title": "Device Status"
          },
          "id": "widget-1748893224225",
          "type": "endpoint-status"
        },
        "widget-1748893281351": {
          "config": {
            "clusterMode": "none",
            "limit": 200,
            "precision": 3,
            "query": "ts>dateRelative(\"-720h\")",
            "title": "Devices"
          },
          "id": "widget-1748893281351",
          "type": "track-map"
        },
        "widget-1748893320108": {
          "config": {
            "query": "\"tags.type\"!=\"queclink-protocol\"",
            "tags": {},
            "title": "Device Alerts"
          },
          "id": "widget-1748893320108",
          "type": "alert-status"
        },
        "widget-1748893585479": {
          "config": {
            "limit": 10,
            "reportId": "65295831ae4a2630c78e4e8f",
            "searchFilter": "\"values.battery\"<25",
            "selectedFields": [
              "battery"
            ],
            "sortDirection": "asc",
            "sortField": "battery",
            "title": "Devices with low battery"
          },
          "id": "widget-1748893585479",
          "type": "report-list"
        },
        "widget-1748894265469": {
          "config": {
            "maxEntries": "30",
            "query": "exists(\"endpointId\")",
            "rowsPerPage": 10,
            "title": "Log Viewer"
          },
          "id": "widget-1748894265469",
          "type": "log-viewer"
        },
        "widget-1749522549574": {
          "config": {
            "maxEntries": 10,
            "query": "\"tags.type\"==\"queclink-battery\" && state!=\"resolved\"",
            "tags": {},
            "title": "Devices with low battery"
          },
          "id": "widget-1749522549574",
          "type": "alert-list"
        },
        "widget-1766073184636": {
          "config": {
            "buckets": [],
            "chartType": "pie",
            "field": "tags.type",
            "fieldType": "string",
            "greaterLabel": "Above Max",
            "lessLabel": "Below Min",
            "query": "",
            "showUnknown": false,
            "tags": [],
            "title": "Endpoint Fields"
          },
          "id": "widget-1766073184636",
          "type": "endpoint-fields"
        },
        "widget-1766073238581": {
          "config": {
            "buckets": [
              {
                "label": "25-50",
                "value": 25
              },
              {
                "label": "50-75",
                "value": 50
              },
              {
                "label": "75-99",
                "value": 75
              }
            ],
            "chartType": "bar",
            "field": "statusDetails.battery",
            "fieldType": "number",
            "greaterLabel": "Full",
            "lessLabel": "Low",
            "query": "",
            "showUnknown": false,
            "tags": [],
            "title": "Endpoint Fields"
          },
          "id": "widget-1766073238581",
          "type": "endpoint-fields"
        }
      }
    }
  ],
  "services": [
    {
      "id": "64daec876c3caaf840775e59",
      "key": "queclink-alerts",
      "modelId": "818c54314c6469493406e874",
      "name": "Queclink - Alerts"
    },
    {
      "id": "672c2cc2f12de00dd3abe65c",
      "key": "queclink-device-alerts",
      "modelId": "81b90f9f768aa772b6f09ed8",
      "name": "Queclink - Device Alerts"
    },
    {
      "id": "61ac3e675d052a1465bf4b68",
      "key": "queclink-track",
      "modelId": "81f51ae0b339efbe51e8cdcb",
      "name": "Queclink - Track"
    },
    {
      "id": "645e93193855f68ba7567044",
      "key": "queclink-listener",
      "modelId": "81418d0e1607815e03483843",
      "name": "Queclink - Listener (ASCII)",
      "params": {
        "extractor": "custom",
        "extractor_config": "{\"format\":\"queclink\"}",
        "port": "{{.port}}",
        "send_events": "true"
      }
    },
    {
      "id": "64da92708af95a1777304712",
      "key": "report",
      "modelId": "81b90f9f768aa772b6f09ed8",
      "name": "Report"
    }
  ],
  "triggerGlobals": [
    {
      "importProtect": false,
      "isSecret": false,
      "key": "queclinkPasswords",
      "value": {
        "GL33": "gl33",
        "GL33CG": "gl33cg",
        "GL501MG": "gl500m",
        "GL502MG": "gl502m",
        "GL521MG": "gl521m",
        "GL53MG": "gl53m",
        "GV500MAP": "gv500",
        "GV53MG": "gv53",
        "GV57MG": "gv57",
        "GV75MG": "gv75m"
      }
    },
    {
      "importProtect": false,
      "isSecret": false,
      "key": "queclinkFota",
      "value": {
        "GV500MAP": {
          "bb": {
            "fileKey": "gv500map_bb",
            "version": "0220"
          },
          "mcu": {
            "url": "http://bridge.blob.core.windows.net/$web/fw/GV500MA_McuR01V6.00.srec",
            "version": "0106",
            "xfileKey": "gv500map_mcu",
            "xurl": "http://bridge-us.tartabit.com/f/613ffa936a7cc5512402f4e6/gv500map_mcu.srec"
          }
        },
        "GV53MG": {
          "bb": {
            "fileKey": "gv53mg_bb",
            "version": "0706"
          }
        }
      }
    },
    {
      "importProtect": false,
      "isSecret": false,
      "key": "queclinkConfig",
      "value": {
        "alerts": true,
        "debug": false,
        "geofences": true,
        "sendAcks": true
      }
    }
  ],
  "doNotStartTriggers": ["665dd302b0b92c3a7902f8a4", "64da92706c3caaf84077528f", "6628662dce72f7b6fc2a6828"],
  "triggers": [
    {
      "def": "\r\nvar msg = event.data.data\r\n\r\nvar model  = {  name: event.endpoint.name,\r\n  values: Object.assign({}, msg)\r\n}\r\nif(msg.gps) {\r\n  model.location = {\r\n      lat: msg.gps.latitude, \r\n      lon: msg.gps.longitude\r\n    }\r\n}\r\n\r\ntrack.publish('queclink-track',event.endpoint.key,msg.ts,model)",
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "genericSample": "{}",
      "id": "645e944c3855f68ba7567049",
      "name": "Queclink - ASCII - Send to Track",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nif(event.endpoint==null) {\r\n    //log.warn('no endpoint defined',event.data)\r\n    trigger.reply({error:'no endpoint defined'})\r\n}\r\n\r\nif(!event.endpoint.statusDetails.iccid) {\r\n    //log.warn('no iccid for endpoint',event.data)\r\n    trigger.reply({error:'no iccid for endpoint'})\r\n}\r\n\r\nif(!trigger.ratelimit('sms:'+event.endpoint.statusDetails.iccid.substring(0, 19),1,10,86400)) {\r\n    log.warn('sms rate limited')\r\n    trigger.reply({error:'sms rate limited'})\r\n}\r\n\r\ncdp_1nce.sendSms('cdp-1nce',event.endpoint.statusDetails.iccid.substring(0, 19),event.data.data.command)\r\n\r\ntrigger.reply({success: true})",
      "desc": "You will need to customize this trigger based on your SMS provider",
      "filterGeneric": "queclink-sms-handler",
      "filterType": "generic",
      "genericSample": "{}",
      "id": "665dd302b0b92c3a7902f8a4",
      "name": "Queclink - ASCII - Optional - SMS Handler",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nif(event.data.payload.startsWith('EXPT:')) {\r\n    log.warn('error communicting with device',event.data.payload)\r\n    trigger.exit()\r\n}\r\n\r\nvar firstComma = event.data.payload.indexOf(',')\r\nvar secondComma = event.data.payload.indexOf(',', firstComma+1)\r\n\r\nvar ver = event.data.payload.substring(firstComma+1,secondComma)\r\nvar cmd = event.data.payload.substring(6,firstComma)\r\n\r\nreport.publish('queclink-sampler',ver+'-'+cmd,event.ts,{values:{version: ver, command: cmd, sample: event.data.payload}})\r\n",
      "filterServiceId": "645e93193855f68ba7567044",
      "filterType": "udp-receive",
      "id": "64da92706c3caaf84077528f",
      "name": "Queclink - ASCII - Optional - Message Sampler",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "geofence.eval(event.endpoint.key,event.ts,event.data.data.gps.latitude,event.data.data.gps.longitude,{context:{command:event.data.data.cmd, eventId: event.id}})",
      "filterCustom": {
        "data.gps.latitude": {
          "comp": "exists",
          "value": ""
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "genericSample": "{}",
      "id": "6628662dce72f7b6fc2a6828",
      "name": "Queclink - ASCII - Optional - Geofence endpoints",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "if(!trigger.ratelimit(event.endpoint.key+':ver',1,1,60)) {\r\n    trigger.exit()\r\n}\r\n\r\nswitch(event.data.data.deviceType) {\r\n    case 'GV50MA':\r\n    case 'GL33':\r\n    case 'GL33CG':\r\n        exec.now('queclink-rto-command', {command:'ver'})\r\n        break\r\n    default:\r\n        exec.now('queclink-rto-command', {command:'ati'})\r\n        break\r\n}",
      "filterCustom": {
        "data.cmd": {
          "comp": "eq",
          "value": "GTPNA"
        },
        "missing-status-detail:ignore-commands:true": {
          "comp": "missing-status-detail",
          "value": "ignore-commands:true"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "genericSample": "{}",
      "id": "663f63193beaaa66bff73ab6",
      "name": "Queclink - ASCII - DM - Query Versions (Power On)",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "if(!trigger.ratelimit(event.endpoint.key+':ver',1,1,60)) {\r\n    trigger.exit()\r\n}\r\n\r\nswitch(event.data.data.deviceType) {\r\n    case 'GV50MA':\r\n    case 'GL33':\r\n    case 'GL33CG':\r\n        exec.now('queclink-rto-command', {command:'ver'})\r\n        break\r\n    default:\r\n        exec.now('queclink-rto-command', {command:'ati'})\r\n        break\r\n}",
      "filterCustom": {
        "missing-status-detail:ignore-commands:true": {
          "comp": "missing-status-detail",
          "value": "ignore-commands:true"
        },
        "missing-tag:firmware": {
          "comp": "missing-tag",
          "value": "firmware"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "genericSample": "{}",
      "id": "661754ceac2f0b904708c23e",
      "name": "Queclink - ASCII - DM - Query Versions (Missing Tag)",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "if(!trigger.ratelimit(event.endpoint.key+':cid',1,1,900)) {\r\n    trigger.exit()\r\n}\r\n\r\nexec.now('queclink-rto-command', {command:'cid'})",
      "filterCustom": {
        "missing-status-detail:iccid": {
          "comp": "missing-status-detail",
          "value": "iccid"
        },
        "missing-status-detail:ignore-commands:true": {
          "comp": "missing-status-detail",
          "value": "ignore-commands:true"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "genericSample": "{}",
      "id": "665dd0090df24921fe0f308e",
      "name": "Queclink - ASCII - DM - Query ICCID",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "switch (event.data.data.cmd) {\r\n    case 'GTDOG':\r\n        cache.set('ignore-power-alarms:' + event.endpoint.id, '1', 120)\r\n        break\r\n    case 'GTPNA':\r\n        alert.resolve('queclink-device-alerts',event.endpoint.key+'-power-off', event.endpoint.name+ ' powered on',{tags:{type:'queclink-power'}})\r\n        break\r\n    case 'GTPNL':\r\n        alert.resolve('queclink-device-alerts',event.endpoint.key+'-power-off', event.endpoint.name+ ' powered on',{tags:{type:'queclink-power'}})\r\n        break\r\n    case 'GTPFA':\r\n        // ignore PFA messages within 2 minutes of GTDOG (watchdog)\r\n        if (cache.get('ignore-power-alarms:' + event.endpoint.id) == null) {\r\n            alert.raise('queclink-device-alerts', event.endpoint.key + '-power-off', event.endpoint.name + ' powered off', 'high', 'device has powered off', { endpointId: event.endpoint.id, tags: { type: 'queclink-power' } })\r\n        }\r\n        break\r\n}\r\n",
      "filterCustom": {
        "data.cmd": {
          "comp": "one-of",
          "value": "GTPFA,GTPNA,GTPNL"
        },
        "has-endpoint": {
          "comp": "has-endpoint",
          "value": ""
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "genericSample": "{}",
      "id": "6602ff53d42f035005935f05",
      "name": "Queclink - ASCII - DM - Power Monitor",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "endpoint.updateTags(event.endpoint.key,{fotaAutoUpgrade:'battery-low'})",
      "filterCustom": {
        "data.cmd": {
          "comp": "eq",
          "value": "GTMPF"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "id": "6714f0badaab4af297728a6e",
      "name": "Queclink - ASCII - DM - FOTA (power-disconnect)",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nvar debug = false\r\nvar maxFailures = 3\r\n\r\nvar fotaObj = cache.get2('fota:'+event.endpoint.key)\r\nif(!fotaObj) {\r\n    log.warn('['+event.endpoint.key+'] fota initiated out of band, cannot track')\r\n    trigger.exit()\r\n}\r\n\r\nvar status = 'unknown'\r\nvar subsystem = fotaObj.subsystem\r\n\r\nif(event.data.data.otaCode) {\r\n    status=event.data.data.otaStatus\r\n    report.publish('queclink-fota-results',event.endpoint.key+'-'+fotaObj.id,event.ts,{name: event.endpoint.name, endpointId: event.endpoint.id, values:{subsystem: subsystem, status: status}})\r\n    if(event.data.data.otaCode==100 || event.data.data.otaCode==110 || event.data.data.otaCode==120 || event.data.data.otaCode==170) {\r\n        fotaObj.inProgress = true\r\n        cache.set2('fota:'+event.endpoint.key, fotaObj, 3600)\r\n        exec.now('queclink-fota-confirmed', {subsystem:subsystem, result:status, previousVersion: fotaObj.have, newVersion: fotaObj.want})\r\n    }\r\n    if(event.data.data.otaDone) {\r\n        fotaObj.inProgress = false\r\n        var rslt = {subsystem:subsystem, result:status}\r\n        if(event.data.data.otaCode!=301 && event.data.data.otaCode!=311 && event.data.data.otaCode!=321 && event.data.data.otaCode!=371) {\r\n            if(status=='refused-low-battery') {\r\n                endpoint.updateTags(event.endpoint.key,{fotaAutoUpgrade:'battery-low'})\r\n            } else if(fotaObj.failureCount) {\r\n                fotaObj.failureCount = fotaObj.failureCount+1\r\n                if(fotaObj.failureCount > maxFailures) {\r\n                    log.trace('too many fota failures, will not be auto upgraded again')\r\n                    endpoint.updateTags(event.endpoint.key,{fotaAutoUpgrade:'too-many-failures'})\r\n                }\r\n            } else {\r\n                fotaObj.failureCount = 1\r\n            }\r\n        } else {\r\n            rslt.version = fotaObj.want\r\n            var tags = {}\r\n            switch(rslt.subsystem) {\r\n                case 'bb':\r\n                    tags.firmware = fotaObj.want\r\n                    if(fotaObj.postUpdateConfigTarget && event.endpoint.tags.configTarget) {\r\n                        var newConfigTarget = fotaObj.postUpdateConfigTarget[event.endpoint.tags.configTarget]\r\n                        if(newConfigTarget) {\r\n                            tags.configTarget = newConfigTarget\r\n                        }\r\n                    }\r\n                    break\r\n                case 'mcu':\r\n                    tags.firmwareMcu = fotaObj.want\r\n                    break\r\n                case 'modem':\r\n                    tags.firmwareModem = fotaObj.want\r\n                    break\r\n            }\r\n            endpoint.updateTags(event.endpoint.key,tags)\r\n            if(event.endpoint.tags.fotaAutoUpgrade && event.endpoint.tags.fotaAutoUpgrade=='true') {\r\n                exec.now('queclink-fota-command', {})\r\n            }\r\n        }\r\n        cache.set2('fota:'+event.endpoint.key, fotaObj, 3600)\r\n        exec.now('queclink-fota-result', {subsystem:subsystem, result:status, previousVersion: fotaObj.have, newVersion: fotaObj.want})\r\n    }\r\n}\r\nvar sd = {fotaStatus: subsystem+'/'+status}\r\nif(subsystem=='bb' && event.data.data.otaDone) {\r\n    sd['configHash']=null\r\n    sd['configStatus']='update-needed-after-fota'\r\n}\r\nendpoint.update(event.endpoint.key,sd)\r\n",
      "filterCustom": {
        "data.cmd": {
          "comp": "eq",
          "value": "GTUPD"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "id": "664f97860df24921fe0f3067",
      "name": "Queclink - ASCII - DM - FOTA (Result)",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "if(event.endpoint.tags.fotaAutoUpgrade) {\r\n    if(event.endpoint.tags.fotaAutoUpgrade!=='true') {\r\n        trigger.exit()\r\n    }\r\n}\r\n\r\n// if GTFRI make sure ignition is off\r\nif(event.data.data.cmd=='GTFRI' && event.data.data.ignition===true) {\r\n    trigger.exit()\r\n}\r\n\r\n//if(!trigger.ratelimit('fota-check:'+event.endpoint.key,1,1,60)) {\r\n//    trigger.exit()\r\n//}\r\n\r\nexec.now('queclink-fota-command', {})",
      "filterCustom": {
        "data.cmd": {
          "comp": "one-of",
          "value": "GTFRI,GTATI,GTVER,GTVGF,GTIGF"
        },
        "has-tag:firmware": {
          "comp": "has-tag",
          "value": "firmware"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "id": "664f97860df24921fe0f3068",
      "name": "Queclink - ASCII - DM - FOTA (Detect)",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "if(event.data.data.battery>90) {\r\n    endpoint.updateTags(event.endpoint.key,{fotaAutoUpgrade:'true'},null)\r\n    exec.now('queclink-fota-command', {})\r\n    trigger.exit()\r\n}\r\nif(event.data.data.cmd=='GTMPN') {\r\n    endpoint.updateTags(event.endpoint.key,{fotaAutoUpgrade:'true'},null)\r\n    exec.now('queclink-fota-command', {})\r\n    trigger.exit()\r\n}\r\n",
      "filterCustom": {
        "has-tag:fotaAutoUpgrade:battery-low": {
          "comp": "has-tag",
          "value": "fotaAutoUpgrade:battery-low"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "id": "6714f0badaab4af297728a6f",
      "name": "Queclink - ASCII - DM - FOTA (Battery Reset)",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "// COTA Update\r\n// When queclink packets are received, check if the targetConfig matches the activeConfig tag.\r\n//   MATCH - do nothing\r\n//   NO TARGETCONFIG - do nothing\r\n//   NO ACTIVECONFIG - update\r\n//   MISMATCH - update\r\n// \r\nvar debug = false\r\n\r\nvar statusDetails = { configStatus: event.data.data.otaStatus}\r\n\r\nif(event.data.data.otaCode) {\r\n    if(event.data.data.otaCode==301) {\r\n        if(event.endpoint.statusDetails.configPendingHash) {\r\n            statusDetails.configHash = event.endpoint.statusDetails.configPendingHash\r\n            statusDetails.configVersion = event.endpoint.statusDetails.configPendingVersion\r\n            statusDetails.configPendingHash = null\r\n            statusDetails.configPendingVersion = null\r\n            statusDetails.configLastUpdated = event.ts\r\n        }\r\n    }\r\n}\r\nendpoint.update(event.endpoint.key,{statusDetails:statusDetails, addTags: {configVersion: statusDetails.configVersion}, removeTags:['configNeeded']})\r\n",
      "filterCustom": {
        "data.cmd": {
          "comp": "eq",
          "value": "GTUPC"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "id": "664f97860df24921fe0f3069",
      "name": "Queclink - ASCII - DM - COTA (Result)",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nexec.now('queclink-cota-command', {})",
      "filterCustom": {
        "data.cmd": {
          "comp": "one-of",
          "value": "GTIGF,GTVGF,GTPNA,GTRTL"
        },
        "has-tag:configTarget": {
          "comp": "has-tag",
          "value": "configTarget"
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "id": "665dd0090df24921fe0f3093",
      "name": "Queclink - ASCII - DM - COTA (Detect)",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nif(event.data.data.battery>80) {\r\n    endpoint.updateTags(event.endpoint.key,{battery:'80+'})\r\n    alert.resolve('queclink-device-alerts',event.endpoint.key+'-battery-low', 'battery charged',{tags:{type:'queclink-battery'}})\r\n} else if(event.data.data.battery>50) {\r\n    endpoint.updateTags(event.endpoint.key,{battery:'50-80'})\r\n    alert.resolve('queclink-device-alerts',event.endpoint.key+'-battery-low', 'battery charged',{tags:{type:'queclink-battery'}})\r\n} else if(event.data.data.battery>20) {\r\n    endpoint.updateTags(event.endpoint.key,{battery:'20-50'})\r\n    alert.resolve('queclink-device-alerts',event.endpoint.key+'-battery-low', 'battery charged',{tags:{type:'queclink-battery'}})\r\n} else {\r\n    endpoint.updateTags(event.endpoint.key,{battery:'<20'})\r\n    alert.raise('queclink-device-alerts',event.endpoint.key+'-battery-low',event.endpoint.name+ ' battery low','medium','battery level: '+event.data.data.battery,{tags:{type:'queclink-battery'}})\r\n}\r\nreport.publish('queclink-battery',event.endpoint.key,event.ts,{name:event.endpoint.name, values:{battery: event.data.data.battery}})\r\n",
      "filterCustom": {
        "data.battery": {
          "comp": "exists",
          "value": ""
        }
      },
      "filterGeneric": "queclink-data",
      "filterType": "generic",
      "id": "6529530e3917527f922ad3a1",
      "name": "Queclink - ASCII - DM - Battery Monitor",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "// turn off this trigger if your device does not expect SACK messages to be sent.\r\n\r\nif (event.endpoint && event.endpoint.statusDetails['ignore-commands'] === 'true') {\r\n    if (global.values.queclinkConfig.debug) {\r\n        log.trace('[' + event.endpoint.key + '] SACK ignored')\r\n    }\r\n    trigger.exit()\r\n}\r\n\r\nvar lastComma = event.data.payload.lastIndexOf(',')\r\nvar id = event.data.payload.substr(lastComma + 1, 4)\r\n\r\nif (global.values.queclinkConfig.debug) {\r\n    log.trace('[' + event.endpoint.key + '] SACK [' + id + '] sent', { lastComma: lastComma, id: id })\r\n}\r\nif (event.endpoint != null) {\r\n    udp.send(event.service.key, event.endpoint.key, '+SACK:' + id + '$')\r\n} else {\r\n    udp.send(event.service.key, event.data.remoteAddr, '+SACK:' + id + '$')\r\n}\r\n",
      "filterServiceId": "645e93193855f68ba7567044",
      "filterType": "udp-receive",
      "id": "645e944c3855f68ba756704f",
      "name": "Queclink - ASCII - Core - Send Ack",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "if (event.data.payload.startsWith('EXPT:')) {\r\n    log.warn('error communicting with device', event.data.payload)\r\n    trigger.exit()\r\n}\r\n\r\nvar firstComma = event.data.payload.indexOf(',')\r\nvar secondComma = event.data.payload.indexOf(',', firstComma + 1)\r\nvar firstColon = event.data.payload.indexOf(':')\r\n\r\nvar ver = event.data.payload.substring(firstComma + 1, secondComma)\r\nvar cmd = event.data.payload.substring(firstColon + 1, firstComma)\r\n\r\nvar obj = {}\r\n\r\nif (event.data.payload.startsWith('+ACK')) {\r\n    var ackDecoders = {\r\n        GTPEO: 'cmd||key||geoId|ack(string)|ts(timestamp,20060102150405)|seq',\r\n        // +ACK:GTRTO,423134,352009111850124,,VBR,0015,20220124211813,0057$\r\n        GTRTO: 'cmd||key||rto|ack(string)|ts(timestamp,20060102150405)|seq',\r\n        //+ACK:GTHBD,5E0100,861971050041292,,20230422125408,13E3$\r\n        DEFAULT: 'cmd||key||ack(string)|ts(timestamp,20060102150405)|seq'\r\n    }\r\n    var ackDecoder = ackDecoders[cmd] || ackDecoders['DEFAULT']\r\n    obj = convert.delimitedStringToObject(event.data.payload, ackDecoder, ',')\r\n    if (cmd == 'GTHBD') {\r\n        udp.send(event.service.key, event.endpoint.key, '+SACK:GTHBD,' + ver + ',' + obj.seq + '$')\r\n        trigger.exit()\r\n    }\r\n    if (global.values.queclinkConfig.debug) {\r\n        log.trace('[' + event.endpoint.key + '] received [' + cmd + '] ack for [' + obj.ack + ']', event.data)\r\n    }\r\n    if (obj.ack) {\r\n        trigger.signal('queclink:' + obj.key + ':' + obj.ack, { packet: event.data.payload, obj: obj })\r\n    }\r\n    exec.now('queclink-ack', obj)\r\n    trigger.exit()\r\n}\r\n\r\n//#region field converters\r\nfunction parseStatus() {\r\n    if (obj.temp && obj.temp.status) {\r\n        var motionStatus = obj.temp.status.slice(0, 2)\r\n        switch (motionStatus) {\r\n            case '11':\r\n                obj.motion = false;\r\n                obj.ignition = false;\r\n                break\r\n            case '12':\r\n                obj.motion = true;\r\n                obj.ignition = false;\r\n                break\r\n            case '21':\r\n                obj.motion = false;\r\n                obj.ignition = true;\r\n                break\r\n            case '22':\r\n                obj.motion = true;\r\n                obj.ignition = true;\r\n                break\r\n            case '16':\r\n                obj.motion = true;\r\n                obj.ignition = false;\r\n                break\r\n            case '41':\r\n                obj.motion = false;\r\n                obj.ignition = false;\r\n                break\r\n            case '42':\r\n                obj.motion = true;\r\n                obj.ignition = false;\r\n                break\r\n        }\r\n    }\r\n}\r\n\r\nfunction parsePowerOnType(pot) {\r\n    switch (pot) {\r\n        case 1:\r\n            obj.powerOnType = 'movement'\r\n            break\r\n        case 2:\r\n            obj.powerOnType = 'time'\r\n            break\r\n        case 3:\r\n            obj.powerOnType = 'light'\r\n            break\r\n        case 4:\r\n            obj.powerOnType = 'switch'\r\n            break\r\n        case 5:\r\n            obj.powerOnType = 'rto'\r\n            break\r\n        case 6:\r\n            obj.powerOnType = 'abnormal'\r\n            break\r\n        case 7:\r\n            obj.powerOnType = 'rtc'\r\n            break\r\n        case 8:\r\n            obj.powerOnType = 'fota'\r\n            break\r\n        case 9:\r\n            obj.powerOnType = 'temperature'\r\n            break\r\n    }\r\n}\r\n\r\nfunction parseRssi(rssi) {\r\n    if (rssi <= 0) {\r\n        return -113;\r\n    } else if (rssi >= 31) {\r\n        return -51;\r\n    } else {\r\n        return (rssi * 2) - 113;\r\n    }\r\n}\r\n\r\nfunction parseUpdateCode(code) {\r\n    var status = code\r\n    var terminal = true\r\n    switch (code) {\r\n        case 100:\r\n        case 110:\r\n        case 170:\r\n            status = 'confirmed'\r\n            terminal = false\r\n            break\r\n        case 101:\r\n        case 111:\r\n        case 171:\r\n            status = 'refused'\r\n            break\r\n        case 102:\r\n        case 112:\r\n        case 172:\r\n            status = 'refused-bad-url'\r\n            break\r\n        case 103:\r\n        case 113:\r\n        case 173:\r\n            status = 'refused-low-battery'\r\n            break\r\n        case 114:\r\n            status = 'refused-mcu'\r\n            break\r\n        case 200:\r\n        case 210:\r\n        case 270:\r\n            status = 'download-start'\r\n            terminal = false\r\n            break\r\n        case 201:\r\n        case 211:\r\n        case 271:\r\n            status = 'download-success'\r\n            terminal = false\r\n            break\r\n        case 202:\r\n        case 212:\r\n        case 272:\r\n            status = 'download-failed'\r\n            break\r\n        case 203:\r\n        case 213:\r\n        case 273:\r\n            status = 'download-bad-version'\r\n            break\r\n        case 300:\r\n        case 310:\r\n        case 370:\r\n            status = 'update-started'\r\n            terminal = false\r\n            break\r\n        case 301:\r\n        case 311:\r\n        case 371:\r\n            status = 'update-success'\r\n            break\r\n        case 302:\r\n        case 312:\r\n        case 372:\r\n            status = 'update-failed'\r\n            break\r\n        case 303:\r\n        case 313:\r\n        case 373:\r\n            status = 'update-failed-low-battery'\r\n            break\r\n        case 305:\r\n            status = 'update-interrupted-by-reboot'\r\n            break\r\n        case 306:\r\n            status = 'update-failed-md5-validation'\r\n            break\r\n\r\n    }\r\n    return { status: status, terminal: terminal }\r\n}\r\n\r\n//#endregion\r\n\r\nfunction setDesc() {\r\n    var descriptions = {\r\n        GTASC: 'accelerator-calibration',\r\n        GTATI: 'basic-device-information',\r\n        GTBPL: 'battery-backup-low',\r\n        GTBTC: 'battery-charge-start',\r\n        GTCID: 'rto-cid',\r\n        GTCSQ: 'rto-csq',\r\n        GTCRA: 'crash',\r\n        GTCRD: 'crash-data',\r\n        GTCRG: 'crash-gnss',\r\n        GTDIS: 'digital-input-change',\r\n        GTDRM: 'device-removal',\r\n        GTDOG: 'watchdog',\r\n        GTEPS: 'external-power-supply-change',\r\n        GTFRI: 'fixed-report',\r\n        GTGEO: 'geofence',\r\n        GTGSS: 'gnss-signal-status',\r\n        GTHBM: 'harsh-driving',\r\n        GTIDF: 'idle-end',\r\n        GTIDN: 'idle-start',\r\n        GTIGL: 'ignition-location',\r\n        GTIGN: 'ignition-on',\r\n        GTIGF: 'ignition-off',\r\n        GTINF: 'info',\r\n        GTJES: 'journey-summary',\r\n        GTLGN: 'login',\r\n        GTLSP: 'vehicle-long-stop',\r\n        GTMPF: 'main-power-disconnected',\r\n        GTMPN: 'main-power-connected',\r\n        GTNMR: 'movement-change',\r\n        GTOBD: 'obd-report',\r\n        GTOER: 'obd-sync',\r\n        GTOPN: 'obd-connected',\r\n        GTOPF: 'obd-disconnected',\r\n        GTPNA: 'power-on',\r\n        GTPNL: 'power-on-location',\r\n        GTPFA: 'power-off',\r\n        GTPDP: 'pdp',\r\n        GTROF: 'radio-off',\r\n        GTRON: 'radio-on',\r\n        GTRTL: 'realtime-report',\r\n        GTSOS: 'sos',\r\n        GTSTC: 'battery-charge-stop',\r\n        GTSTP: 'vehicle-stop',\r\n        GTSTR: 'vehicle-start',\r\n        GTSTT: 'motion-status-change',\r\n        GTTEM: 'alarm-temperature',\r\n        GTTOW: 'alarm-tow',\r\n        GTUPC: 'cota-status',\r\n        GTUPD: 'ota-status',\r\n        GTVER: 'realtime-version',\r\n        GTVGF: 'virtual-ignition-off',\r\n        GTVGL: 'virtual-ignition-location',\r\n        GTVGN: 'virtual-ignition-on',\r\n        GTWFI: 'wifi-report',\r\n    };\r\n    if (!descriptions[cmd]) {\r\n        log.warn('no description for [' + cmd + ']')\r\n    }\r\n    obj.desc = descriptions[cmd] || cmd;\r\n}\r\n\r\nvar decoders = {\r\n    '690603': {\r\n        DeviceType: 'GV57MG',\r\n        BaseVersion: '700100',\r\n        // GTSTT,690603,861106050014334,,42,0,,,,,,,0302,0720,71AC,01918D15,00,20231005172532,0002$ GV53 match\r\n        //GTSTT: 'cmd|ver|key||temp.status|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTPDP,690603,861106050014334,,20231006130406,000D$\r\n        //GTPDP: 'cmd|ver|key||ts(timestamp,20060102150405)|seq',\r\n        GTDRM: 'cmd|ver|key||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTFRI,690603,861106050014334,,,10,1,1,0.0,156,98.1,-75.635422,45.448782,20231006135821,0302,0720,71AC,00755779,00,0.0,00000:00:00,,,100,418000,19,0,5,20231006140041,0014$\r\n        GTFRI: 'cmd|ver|key||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|hourMeter(string)|||battery(int)|temp.status|rssi(int)|ber(int)|satCount(int)|ts(timestamp,20060102150405)|seq'\r\n    },\r\n    '8A0100': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '700100',\r\n        //+RESP:GTATI,8A0100,867963063179452,ARMOR4,GV57ARMG,00043083,011A,0106,0302,0101,0103,44,20240507181230,003A$\r\n        //+RESP:GTATI,8A0100,867963063030879,ARMOR4,GV57ARMG,00043081,0114,0301,0101,0103,44,20240507211338,05FC$\r\n        GTATI: 'cmd|ver|key||deviceType||fwVersion|mcuVersion|modemFwVersion|hwVersion|modemHwVersion|sensorId|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTDIS,8A0100,867963063046370,ARMOR4,,00,1,0,0.0,137,121.9,-89.697661,39.678759,20231206010616,0310,0260,0000,0000,,0.0,86460,20231207181949,20231207181951,0295$\r\n        GTDIS: 'cmd|ver|key||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|onDuration(int)|stateChangeTs(timestamp,20060102150405)|ts(timestamp,20060102150405)|seq',\r\n        GTEPS: 'cmd|ver|key||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        GTFRI: 'cmd|ver|key||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|hourMeter(string)|battery(int)|temp.status|||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTIGF,8A0100,867963063030200,ARMOR4,26,0,0.0,0,198.4,-89.745660,39.592113,20240312213305,0310,0260,A283,01DAF20D,,,0.0,0,20240313010139,019B$\r\n        GTIGF: 'cmd|ver|key||ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|externalPowerVcc(int)|ts(timestamp,20060102150405)|seq',\r\n        GTIGN: 'cmd|ver|key||ignitionOffDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|externalPowerVcc(int)|ts(timestamp,20060102150405)|seq',\r\n        GTVER: 'cmd|ver|key||deviceType|fwVersion|hwVersion|modemHwVersion|modemFwVersion|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTVGF,8A0100,867963063046370,ARMOR4,2,98,0,0.0,316,188.4,-89.745775,39.591953,20240205194734,0310,0260,A283,01DAF20B,,,0.0,9126,20240205194736,003E$\r\n        GTVGF: 'cmd|ver|key||temp.virtualIgnitionMode(int)|ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|externalPowerVcc(int)|ts(timestamp,20060102150405)|seq',\r\n        GTVGN: 'cmd|ver|key||temp.virtualIgnitionMode(int)|ignitionOffDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|externalPowerVcc(int)|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '8A0201': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0100',\r\n    },\r\n    '8A0202': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0100',\r\n    },\r\n    '8A0203': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0100',\r\n    },\r\n    '8A0204': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0100',\r\n    },\r\n    '8A0205': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0100',\r\n    },\r\n    '8A0206': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0100',\r\n    },\r\n    '8A0207': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0100',\r\n    },\r\n    '8A0208': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0100',\r\n        GTINF: 'cmd|ver|key||temp.status(string)|iccid(string)|rssi(int)|ber(int)|temp.externalPowerSupply(int)|temp.externalPowerVoltage(int)||backupBatteryVoltage(float)|temp.charging(int)|temp.ledOn(int)|||gps.ts(timestamp,20060102150405)|||||||simCardAbnormal(bool)|tzOffset(string)|tzIsDst(int)|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '8A020A': {\r\n        DeviceType: 'GV57ARMG',\r\n        BaseVersion: '8A0208',\r\n    },\r\n    '940100': {\r\n        DeviceType: 'GV57ARMGP',\r\n        BaseVersion: '8A0208',\r\n        GTWFI: 'cmd|ver|key||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|wifi(array,3)|ssid(string)|bssid(string)|rssi(int)|||ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '940106': {\r\n        DeviceType: 'GV57ARMGP',\r\n        BaseVersion: '940100',\r\n    },\r\n    '940107': {\r\n        DeviceType: 'GV57ARMGP',\r\n        BaseVersion: '940100',\r\n    },\r\n    'DE0114': {\r\n        DeviceType: 'GL501MG',\r\n        // +RESP:GTATI,C50300,863695050491680,,43083,000d03,0107,BG95-M5,BG95M5LAR02A03,20240523191333,1350$\r\n        // +RESP:GTATI,C50300,866833040158740,,43083,000d03,0106,BG95-M5,BG95M5LAR02A03,20240523200044,1666$\r\n        GTATI: 'cmd|ver|key|||fwVersion|hwVersion|modemHwVersion|modemFwVersion|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTBPL,C50204,863695050491680,,0,0,1,2,0.0,261,76.3,-75.635375,45.448606,20231009192207,0302,0720,71AC,00755779,14,99,,8,1,0,14.9,20231009192209,0295$\r\n        GTBPL: 'cmd|ver|key||temp.eventState(int)|||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId|rssi(int)|ber(int)||battery(int)|temp.modeSelection(int)|temp.movementStatus(int)|temperature(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTBTC,DE0114,865284049298189,GL500M,73,20230425164241,A235$\r\n        GTBTC: 'cmd|ver|key||battery(int)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTFRI,DE0114,865284049298189,GL500M,0,0,1,2,0.0,0,108.0,-75.635252,45.448806,20230425140349,0302,0720,AE45,0075577C,13,0,,73,0,0,25.9,20230425140349,A226$\r\n        // +RESP:GTCID,C50300,866833040158401,,89320420000006887051,20240222024909,00FA$\r\n        GTCID: 'cmd|ver|key||iccid(string)|ts(timestamp,20060102150405)|seq',\r\n        //  +RESP:GTCSQ,C50300,863695050506339,,15,99,20240329024707,1266$\r\n        GTCSQ: 'cmd|ver|key||rssi(int)|ber(int)|ts(timestamp,20060102150405)|seq',\r\n        GTDOG: 'cmd|ver|key||temp.reportId(string)|temp.reportType(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId|rssi(int)|ber(int)||battery(int)|temp.modeSelection(int)|temp.movementStatus(int)|temperature(float)|ts(timestamp,20060102150405)|seq',\r\n        GTFRI: 'cmd|ver|key||temp.reportId(string)|temp.reportType(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId|rssi(int)|ber(int)||battery(int)|temp.modeSelection(int)|temp.movementStatus(int)|temperature(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTINF,C50204,863695050506339,,89882280666032702593,18,99,,1,,60,27.4,20231019182730,1,,,,,,,20231020153313,009D$\r\n        GTINF: 'cmd|ver|key||iccid(string)|rssi(int)|ber(int)||||battery(int)|temperature(float)|gps.ts(timestamp,20060102150405)|temp.movementStatus(int)|||||||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTPFA,DE0301,865284049298189,GL500M,20230927022123,0F6E$\r\n        GTPFA: 'cmd|ver|key||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTSTC,DE0301,865284049298189,GL500M,100,20230817060224,05D2$\r\n        GTSTC: 'cmd|ver|key||battery(int)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTPNA,DE0114,865284049298189,GL500M,1,20230425140237,A220$\r\n        GTPNA: 'cmd|ver|key||temp.powerOnType(int)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTNMR,DE0114,865284049298189,GL500M,0,0,1,2,0.0,0,108.0,-75.635252,45.448806,20230425140558,0302,0720,AE45,0075577C,19,0,,73,0,0,26.1,20230425140557,A22D$\r\n        GTNMR: '@GTDOG',\r\n        // +RESP:GTPNL,DE0114,865284049421591,GL500M,0,0,1,0,0.0,0,75.0,-75.635416,45.448852,20230403020337,0302,0720,AE45,0075577C,0,0,,90,0,0,31.1,20230425170024,75D2$\r\n        GTPNL: '@GTDOG',\r\n        // +RESP:GTSOS,DE0114,865284049298189,GL500M,0,0,1,0,0.0,0,108.0,-75.635252,45.448806,20230425140558,0302,0720,AE45,0075577C,14,0,,73,1,1,26.3,20230425164219,A234$\r\n        GTRTL: '@GTDOG',\r\n        GTSOS: 'cmd|ver|key|||||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId|rssi(int)|ber(int)||battery(int)|temp.modeSelection(int)|temp.movementStatus(int)|temperature(float)|ts(timestamp,20060102150405)|seq',\r\n        GTTEM: '@GTBPL',\r\n        // +RESP:GTUPC,C50300,863695050506339,,001,302,http://bridge-us.tartabit.com/webhook/qlcd/gl521mg/863695050506339.ini,20240216193707,09C3$\r\n        GTUPC: 'cmd|ver|key||commandId(string)|otaCode(int)|url(string)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTVER,C50300,863695050506339,,C5,0D03,0107,,BG95-M5,BG95M5LAR02A03,20240329025845,126D$\r\n        GTVER: 'cmd|ver|key||deviceType|fwVersion|hwVersion||modemHwVersion|modemFwVersion|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    'DE0301': {\r\n        DeviceType: 'GL501MG',\r\n        BaseVersion: 'DE0114',\r\n    },\r\n    'D50403': {\r\n        DeviceType: 'GL502MG',\r\n        BaseVersion: 'DE0114',\r\n        // +RESP:GTATI,D50403,865323050021286,,13091,140902,0107,0202,BG95-M5,BG95M5LAR02A03,GL502M_BT_R20A01V03,20241107020025,066E$\r\n        GTATI: 'cmd|ver|key|||fwVersion|hwVersion|bootLoader|modemHwVersion|modemFwVersion|btVersion|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTWFI,D50403,865323050001825,,FRI,10,BELL014,0c-ac-8a-a2-fa-eb,-32,AP-61B752,80-02-9c-61-b7-54,-40,DIRECT-b7-HP laser-printer,42-49-0f-ab-81-b7,-43,QWERTY-Guest,26-5a-4c-2b-d5-90,-47,QWERTY,24-5a-4c-6b-d5-90,-48,QWERTY-IOT,26-5a-4c-3b-d5-90,-50,QWERTY-IOT,6a-d7-9a-3b-ed-ea,-61,QWERTY,24-5a-4c-6b-d9-80,-63,QWERTY,68-d7-9a-3b-ed-ea,-63,QWERTY-IOT,26-5a-4c-3b-d9-80,-64,20241108032300,06C9$\r\n        GTWFI: 'cmd|ver|key||fixType(string)|wifi(array,3)|ssid(string)|bssid(string)|rssi(int)|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    'CC0204': {\r\n        DeviceType: 'GL520MG',\r\n        BaseVersion: 'DE0114',\r\n    },\r\n    'C50204': {\r\n        DeviceType: 'GL521MG',\r\n        BaseVersion: 'DE0114',\r\n    },\r\n    'C50300': {\r\n        DeviceType: 'GL521MG',\r\n        BaseVersion: 'DE0114',\r\n    },\r\n    'C40101': {\r\n        DeviceType: 'GL522MG',\r\n        BaseVersion: 'DE0114',\r\n    },\r\n    '2E0701': {\r\n        DeviceType: 'GL53MG',\r\n        BaseVersion: 'DE0114',\r\n        // +RESP:GTNMR,2E0701,868042060310987,,,0,1,0,,,,,,,0302,0610,2D83,0358070A,21,0,,100,0,0,1,12,20241106152714,001A$\r\n        GTDOG: 'cmd|ver|key|||temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId|rssi(int)|ber(int)||battery(int)|temp.modeSelection(int)|temp.movementStatus(int)|rat(int)|band(int)|ts(timestamp,20060102150405)|seq',\r\n        GTFRI: '@GTDOG',\r\n        GTNMR: '@GTDOG',\r\n    },\r\n    'C80309': {\r\n        DeviceType: 'GV75MG',\r\n        GTBTC: 'cmd|ver|key||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        //+RESP:GTCID,C80309,861039050297338,GV75M,89882280666032702627,20240617142517,084C$\"\r\n        GTCID: 'cmd|ver|key||iccid(string)|ts(timestamp,20060102150405)|seq',\r\n        //+RESP:GTCRA,C80309,861039050297338,GV75M,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,0302,0720,71AC,00755779,00,20230929170821,032C$\r\n        GTCRA: '@GTBTC',\r\n        //+BUFF:GTCRD,C80309,861039050297338,GV75M,1,10,6,00000002007C00000002007E00000002007DFFFE0002007D00000002007D00000002007E00000002007D00000002007E00000002007D00000002007E00000002007D00000002007E00000002007C00000002007D00010002007D00000004007D00000002007D00010002007D00000002007D00000002007E00000004007D00000002007D00060002007C00010002007D00000001007C00000002007E00000002007D00000002007E00000002007D00000002007EFFFE0002007D00000004007E00000002007C00000002007D00000002007E00000002007C00000004007E00000002007C00000002007D00000002007E00010002007D00060002007E00000002007E00000002007D00010002007D00000002007E00000002007D00010004007D00000002007E00000004007E00000004007C00000002007C00000004007D00000002007EFFFE0002008200010002007E00000002007C00000002007D00000004007E00000002008300000002007D00000002007C00000002007DFFFE0002007E00000002007E00000001007D00000002007DFFFE0002007E00000002007E00000004007D00000002007D00000002007E00000004007E00000002007E00000002007C00000004007C00000002007E00000002007D00010002007D00000002007E00000002007D00000002007D00000002007E00000002007CFFFE0002007E00000002007E00000002007D00000002007C00060002007D00000004007E00000004007D00000002007C00000002007D00000004007C00000002007D00000002007E00000002007E00060002007D00010001007D00000002007E,20230928201652,022B$\r\n        GTCRD: 'cmd|ver|key||temp.dataType(int)|frameTotal(int)|frameNumber(int)|temp.data(string)|ts(timestamp,20060102150405)|seq',\r\n        //+RESP:GTCRG,C80309,861039050297338,GV75M,1,10,1,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,2,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,3,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,4,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,5,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,6,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,7,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,8,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,9,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,10,0,0.0,0,114.1,-75.635443,45.448860,20230929165511,20230929170831,036E$\r\n        GTCRG: 'cmd|ver|key||temp.dataType(int)|gps(array,8)|index(int)|accuracy(int)|speed(float)|heading(int)|altitude(float)|longitude(float)|latitude(float)|ts(timestamp,20060102150405)|ts(timestamp,20060102150405)|seq',\r\n        //+RESP:GTFRI,C80309,861039050297338,GV75M,,10,1,2,0.0,0,114.1,-75.635326,45.448882,20230929075458,0302,0720,71AC,01918D15,00,0.0,00000:00:00,,,100,114003,,,,20230929075459,02E4$\r\n        GTFRI: 'cmd|ver|key||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|hourMeter(string)|||battery(int)|temp.status||||ts(timestamp,20060102150405)|seq',\r\n        GTMPF: '@GTBTC',\r\n        GTMPN: '@GTBTC',\r\n        //+RESP:GTPDP,C80309,861039050297338,GV75M,20231010044552,044E$\r\n        GTPDP: 'cmd|ver|key||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTSTT,C80309,861039050297338,GV75M,11,0,0.0,0,114.1,-75.635426,45.448846,20231002225606,0302,0720,71AC,00755779,00,20231002232554,0449$\r\n        GTSTC: 'cmd|ver|key||temp.status|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        GTSTT: '@GTSTC',\r\n        // +RESP:GTVER,C80309,861039050297338,GV75M,GV75M,070B,0102,,BG96,BG96MAR04A04M1G,20240418072514,07ED$\r\n        GTVER: 'cmd|ver|key||deviceType|fwVersion|hwVersion||modemHwVersion|modemFwVersion|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '5E0100': {\r\n        DeviceType: 'GV500MAP',\r\n        GTASC: 'cmd|ver|key|vin||forward.x(int)|forward.y(int)|forward.z(int)|side.x(int)|side.y(int)|side.z(int)|vertical.x(int)|vertical.y(int)|vertical.z(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        //+RESP:GTATI,5E0100,861971050041292,YV4BR0PM8J1370127,,GV500MAP,00043081,0134,0106,0103,0101,FA,20240524020343,3B1D$\r\n        //+RESP:GTATI,5E0203,861971050041292,YV4BR0PM8J1370127,,GV500MAP,00043083,0220,0400,0106,0103,0101,FA,20240529020112,0AE1$\r\n        GTATI: 'cmd|ver|key|vin||deviceType||fwVersion|mcuVersion|hwVersion|obdVersion|modemFwVersion|modemHwVersion|sensorId|ts(timestamp,20060102150405)|seq',\r\n        GTBPL: 'cmd|ver|key|vin||backupBatteryVcc(float)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTBTC,5E0100,861971050041292,,,0,0.0,0,84.1,-75.635328,45.448699,20230422125548,0302,0720,AE45,0075577C,00,20230422130430,13EB$\r\n        GTBTC: 'cmd|ver|key|vin||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        GTCID: 'cmd|ver|key|||iccid(string)|ts(timestamp,20060102150405)|seq',\r\n        GTDIS: 'cmd|ver|key|vin|||temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        GTDOG: '@GTDIS',\r\n        // +RESP:GTFRI,5E0100,861971050041292,,,,10,1,4,0.0,0,84.1,-75.635328,45.448699,20230422032313,0302,0720,AE45,0075577C,00,1942.2,,,,,110000,,,,20230422032552,13A9$\r\n        // +RESP:GTFRI,5E0100,861971050041292,YV4BR0PM8J1370127,,,81,1,1,20.3,50,57.6,-75.647592,45.428375,20231010194018,0302,0720,71AC,007EB407,00,9070.2,,,,,220000,860,inf,0,20231010194017,A313$\r\n        GTFRI: 'cmd|ver|key|vin||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|hourMeter(string)||||temp.status|obd.rpm(int)|obd.fuelConsumption(float)|obd.fuelLevelInput(int)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTGEO,5E0100,861971050041292,,,,20,1,3,25.8,78,63.1,-75.634335,45.451444,20230422144226,0302,0720,AE45,0075577C,00,1942.5,20230422144227,141E$\r\n        GTGEO: '@GTDIS',\r\n        // +RESP:GTIDF,5E0100,861971050041292,,,11,135,0,,,,,,,0302,0720,AE45,0075577C,00,1942.2,20230422025529,139F$\r\n        GTIDF: 'cmd|ver|key|vin||temp.status(string)|duration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTIDN,5E0100,861971050041292,,,,,0,0.0,0,63.1,-75.635328,45.448781,20230422130735,0302,0720,AE45,0075577C,00,1942.1,20230422130736,13FB$\r\n        GTIDN: 'cmd|ver|key|vin||||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTIGL,5E0100,861971050041292,YV4BR0PM8J1370127,,,00,1,2,31.6,163,73.9,-75.634445,45.449472,20230422165240,0302,0720,B039,007DF081,00,1951.6,20230422165240,147C$\r\n        GTIGF: 'cmd|ver|key|vin||ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTIGL,5E0100,861971050041292,YV4BR0PM8J1370127,,,00,1,2,31.6,163,73.9,-75.634445,45.449472,20230422165240,0302,0720,B039,007DF081,00,1951.6,20230422165240,147C$\r\n        GTIGL: '@GTDIS',\r\n        GTIGN: 'cmd|ver|key|vin||ignitionOffDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTINF,5E0100,861971050041292,,,11,89883070000011234083,14,99,1,4958,,0.00,0,2,,,20230422040826,,,,,,+0000,0,20230422042201,13B0$\r\n        GTINF: 'cmd|ver|key|vin||temp.status(string)|iccid(string)|rssi(int)|ber(int)|temp.externalPowerSupply(int)|temp.externalPowerVoltage(int)||backupBatteryVoltage(float)|temp.charging(int)|temp.ledOn(int)|||gps.ts(timestamp,20060102150405)||||||tzOffset(string)|tzIsDst(int)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTJES,5E0100,861971050041292,YV4BR0PM8J1370127,,10007F,0,972,909,19,17,39,35,0,49.9,158,68.5,-75.641545,45.431563,20230422145254,20230422145255,1445$\r\n        // +RESP:GTJES,5E0100,861971050041292,YV4BR0PM8J1370127,,10007F,0,1150,1150,30,30,47,47,0,25.3,61,86.7,-75.631189,45.446162,20230423034639,20230423034640,180A$\r\n        // GTJES can be customized based on the mask, so this command may need to be updated based on your config\r\n        GTJES: 'cmd|ver|key|vin||temp.mask(string)|summary.fuelConsumption(int)|summary.rpmMax(int)|summary.rpmAvg(int)|summary.throttleMax(int)|summary.throttleAvg(int)|summary.engineLoadMax(int)|summary.engineLoadAvg(int)|summary.mileage(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        GTMPF: 'cmd|ver|key|vin||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTMPF,5E0100,861971050041292,,,0,0.0,0,84.1,-75.635328,45.448699,20230422125548,0302,0720,AE45,0075577C,00,20230422130332,13E6$\r\n        GTMPN: '@GTMPF',\r\n        // +RESP:GTOBD,5E0100,861971050041292,,,0,11FFFF,,1,12298,,,,,,,,,,,,,,00,0,0.0,0,63.1,-75.635328,45.448781,20230422130731,20230422130732,13F8$\r\n        // +RESP:GTOBD,5E0100,861971050041292,YV4BR0PM8J1370127,,0,71FFFF,YV4BR0PM8J1370127,1,12804,983A81E0,1595,43,74,8.9,28096,0,0,0,,19,23,9,33,0,0.0,64,93.9,-75.635893,45.451264,20230424013806,0302,0720,B039,007DF081,00,2002.8,20230424013806,1A2E$\r\n        GTOBD: 'cmd|ver|key|vin||temp.reportId(string)|temp.mask(string)|obd.vin(string)|obd.connection(bool)|obd.powerVoltage(int)|obd.supportedPids(string)|obd.rpm(int)|obd.speed(int)|obd.engineTemp(int)|obd.fuelConsumption(float)|obd.dtcClearedDistance(int)|obd.milActivatedDistance(int)|obd.milStatus(int)|obd.dtcCount(int)|temp.dtcs(string)|obd.throttle(int)|obd.engineLoad(int)|obd.fuelLevelInput(int)|obd.protocol(string)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTOER,5E0100,861971050041292,,,228,00,,0,0.0,0,84.1,-75.635328,45.448699,20230422125548,0302,0720,AE45,0075577C,00,20230422130528,13ED$\r\n        GTOER: 'cmd|ver|key|vin||obd.code(string)|obd.protocol(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTOPN,5E0100,861971050041292,,,0,0.0,0,84.1,-75.635328,45.448699,20230422125548,0302,0720,AE45,0075577C,00,20230422130432,13EC$\r\n        GTOPN: '@GTMPF',\r\n        GTOPF: '@GTMPF',\r\n        // +RESP:GTPDP,5E0100,861971050041292,YV4BR0PM8J1370127,,20230818130031,F589$\r\n        GTPDP: 'cmd|ver|key|vin||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTPFA,5E0100,861971050041292,YV4BR0PM8J1370127,,20230427020031,2BD6$\r\n        GTPFA: '@GTPDP',\r\n        // +RESP:GTPNA,5E0100,861971050041292,YV4BR0PM8J1370127,,20230427020041,2BD7$\r\n        // +RESP:GTPNA,5E0100,861971050041292,YV4BR0PM8J1370127,,20230815020048,E79B$\r\n        GTPNA: '@GTPDP',\r\n        GTPNL: '@GTDIS',\r\n        GTRTL: '@GTDIS',\r\n        // +RESP:GTSTC,5E0100,861971050041292,,,,0,,,,,,,0302,0720,AE45,0075577C,00,20230422025534,13A1$\r\n        GTSTC: 'cmd|ver|key|vin||temp.status|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTSTP,5E0100,861971050041292,,,,,0,0.0,0,63.1,-75.635328,45.448781,20230422130735,0302,0720,AE45,0075577C,00,1942.1,20230422130736,13F9$\r\n        GTSTP: '@GTIDN',\r\n        // +RESP:GTSTR,5E0100,861971050041292,,,,,0,0.0,0,84.1,-75.635328,45.448699,20230422125548,0302,0720,AE45,0075577C,00,1942.1,20230422130532,13EE$\r\n        GTSTR: '@GTIDN',\r\n        // +RESP:GTSTT,5E0100,861971050041292,,,11,0,,,,,,,0302,0720,AE45,0075577C,00,20230422025529,139E$\r\n        GTSTT: '@GTSTC',\r\n        GTUPC: 'cmd|ver|key|vin||commandId(string)|otaCode(int)|url(string)|ts(timestamp,20060102150405)|seq',\r\n        GTUPD: 'cmd|ver|key|vin||otaCode(int)||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTVER,5E0100,861971050041292,YV4BR0PM8J1370127,,GV500MAP,0134,0103,20240411160213,1905$\r\n        GTVER: 'cmd|ver|key|vin||deviceType|fwVersion|hwVersion|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTVGF,5E0100,861971050041292,,,00,4,363,0,0.0,0,63.1,-75.635328,45.448781,20230422130950,0302,0720,AE45,0075577C,00,,1942.1,20230422130951,1404$\r\n        GTVGF: 'cmd|ver|key|vin|||temp.virtualIgnitionMode(int)|ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTVGL,5E0100,861971050041292,YV4BR0PM8J1370127,,,41,1,1,0.0,66,87.4,-75.636186,45.444622,20230819020120,0302,0720,71AC,00755779,00,7549.8,20230819020120,FF70$\r\n        GTVGL: '@GTDIS',\r\n        // +RESP:GTVGN,5E0100,861971050041292,YV4BR0PM8J1370127,,00,4,0,0,25.0,330,75.3,-75.634355,45.449680,20230828140917,0302,0720,71AC,00755779,00,,7782.2,20230828140917,1852$\r\n        GTVGN: 'cmd|ver|key|vin|||temp.virtualIgnitionMode(int)|ignitionOffDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '5E0203': {\r\n        DeviceType: 'GV500MAP',\r\n        BaseVersion: '5E0100',\r\n    },\r\n    'FE170C': {\r\n        DeviceType: 'GV50MA',\r\n        // +RESP:GTASC,FE170E,015700000724326,,1,0,98,19,4,19,-97,-99,1,-4,1,,,,-121.281942,37.798414,20231106183520,,,,,,,14A0$\r\n        GTASC: 'cmd|ver|key||temp.calibrationStatus(int)|forward.x(int)|forward.y(int)|forward.z(int)|side.x(int)|side.y(int)|side.z(int)|vertical.x(int)|vertical.y(int)|vertical.z(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        //+BUFF:GTCID,700100,868487004368429,GV53MG,89882280666032702577,20230420194156,00B6$\r\n        GTCID: 'cmd|ver|key||iccid(string)|ts(timestamp,20060102150405)|seq',\r\n        //+BUFF:GTDOG,FE170F,015700000474856,,,01,1,0,,,,-85.491462,32.602870,20230302194917,,,,,,,,2927$\r\n        GTDOG: 'cmd|ver|key|||temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        //+RESP:GTFRI,FE170F,015700000474856,,,60,1,0,,,,-85.491462,32.602870,20230302194917,,,,,,,00094:48:24,94,410000,,,,2C53$\r\n        GTFRI: 'cmd|ver|key||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|hourMeter(string)|battery(int)|temp.status|||ts(timestamp,20060102150405)|seq',\r\n        GTVER: 'cmd|ver|key||deviceType|fwVersion|hwVersion||modemHwVersion|modemFwVersion|ts(timestamp,20060102150405)|seq',\r\n        //+BUFF:GTVGF,FE170F,015700000474856,,2,843,0,,,,-85.491462,32.602870,20230302194917,,,,,,00094:48:24,,,2999$\r\n        GTVGF: 'cmd|ver|key||temp.virtualIgnitionMode(int)|ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        //+BUFF:GTVGN,FE170F,015700000474856,,2,34607,0,,,,-85.491462,32.602870,20230302194917,,,,,,00094:34:22,,,298A$\r\n        GTVGN: 'cmd|ver|key||temp.virtualIgnitionMode(int)|ignitionOffDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        GTIGF: 'cmd|ver|key||ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTIGN,FE170C,868446032127082,,9119,0,,,,-90.173554,35.132168,20230828163850,,,,,,00700:10:53,,,0A5A$\r\n        GTIGN: 'cmd|ver|key||ignitionOffDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    'FE170E': {\r\n        DeviceType: 'GV50MA',\r\n        BaseVersion: 'FE170C',\r\n    },\r\n    'FE170F': {\r\n        DeviceType: 'GV50MA',\r\n        BaseVersion: 'FE170C',\r\n    },\r\n    '700100': {\r\n        DeviceType: 'GV53MG',\r\n        GTASC: 'cmd|ver|key||temp.calibrationStatus(int)|forward.x(int)|forward.y(int)|forward.z(int)|side.x(int)|side.y(int)|side.z(int)|vertical.x(int)|vertical.y(int)|vertical.z(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        GTATI: 'cmd|ver|key||deviceType||fwVersion|modemFwVersion|hwVersion|modemHwVersion|sensorId|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTBPL,700201,865918060729107,GV53MG,3.68,0,0.0,0,207.1,-88.932710,39.868450,20230418164952,0310,0260,A2E4,005EEC0B,,20230418165133,00C2$\r\n        GTBPL: 'cmd|ver|key||backupBatteryVoltage(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTBTC,700201,865918060799480,,0,0.0,119,196.3,-89.697145,39.678615,20230407201452,0310,0410,4008,03483D09,,20230407201454,089B$\r\n        GTBTC: 'cmd|ver|key||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        //+BUFF:GTCID,700100,868487004368429,GV53MG,89882280666032702577,20230420194156,00B6$\r\n        GTCID: 'cmd|ver|key||iccid(string)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTCRA,700201,865918060730212,ARMOR3,2,0,0.0,51,211.6,-88.932756,39.868401,20240209222933,0310,0410,4005,04328E08,,20240209222935,02EA$\r\n        GTCRA: 'cmd|ver|key||crashCounter(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        GTCRD: 'cmd|ver|key||crashCounter(int)|temp.dataType(int)|frameTotal(int)|frameNumber(int)|temp.data(string)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTCRG,700201,865918060730212,ARMOR3,2,1,7,1,0.0,51,211.6,-88.932756,39.868401,20240209222934,1,0.0,51,211.6,-88.932756,39.868401,20240209222935,1,0.0,51,211.6,-88.932756,39.868401,20240209222936,1,0.0,51,211.6,-88.932756,39.868401,20240209222937,1,0.0,51,211.6,-88.932756,39.868401,20240209222938,1,0.0,51,211.6,-88.932756,39.868401,20240209222939,1,0.0,51,211.6,-88.932756,39.868401,20240209222940,20240209222942,02F8$\r\n        GTCRG: 'cmd|ver|key||crashCounter(int)|temp.dataType(int)|gpsRecords(array,7)|accuracy(int)|speed(float)|heading(int)|altitude(float)|longitude(float)|latitude(float)|ts(timestamp,20060102150405)|ts(timestamp,20060102150405)|seq',\r\n        GTCSQ: 'cmd|ver|key||rssi(int)|fer(int)|ts(timestamp,20060102150405)|seq',\r\n        GTDOG: 'cmd|ver|key|||temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        GTDOS: 'cmd|ver|key||wave1OutputId(int)|wave1OutputActive(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        //+RESP:GTDIS,700201,865918060755169,GV53MG,,10,1,0,0.0,0,192.0,-88.932684,39.868582,20230927182954,0310,0260,A2E4,005EEC0B,,0.0,20230927192331,8288$\r\n        GTDIS: '@GTDOG',\r\n        // +RESP:GTEPS,700701,868487004367421,,13486,11,1,1,0.0,274,322.8,-81.489020,41.507672,20241202152218,0310,0260,A0FA,005AD815,,2715.8,20241202152219,BDA4$\r\n        GTEPS: 'cmd|ver|key||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTFRI,700201,865918060799480,,,60,1,1,0.0,231,189.1,-89.696933,39.678564,20230411145359,0310,0410,4008,03483D09,,0.0,,100,110000,,,20230411145400,\r\n        GTFRI: 'cmd|ver|key||externalPowerVcc(int)|temp.reportId(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|hourMeter(string)|battery(int)|temp.status|||ts(timestamp,20060102150405)|seq',\r\n        GTGSS: 'cmd|ver|key||temp.gnssStatus|gps.satellitesInUse(int)|temp.status||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTHBM,700600,868487004367421,,,10,1,1,5.2,135,89.3,-75.635394,45.448910,20240419123247,0302,0220,2D83,0358070A,,0.0,20240419123248,03CB$\r\n        GTHBM: '@GTDOG',\r\n        GTIDF: 'cmd|ver|key||temp.status|idleDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        GTIDN: 'cmd|ver|key||||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        GTIGF: 'cmd|ver|key||ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTIGF,700201,865918060767412,GV53MG,46,0,0.0,0,94.8,-155.988072,19.818914,20270104012743,0310,0260,B800,06375717,,,0.0,20231030141234,0168$\r\n        GTIGF: 'cmd|ver|key||ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTIGL,8A0100,867963063030200,ARMOR4,,00,1,0,0.0,0,198.4,-89.745660,39.592113,20240312213305,0310,0260,A283,01DAF20D,,0.0,20240313010313,019F$\r\n        GTIGL: '@GTDOG',\r\n        //+RESP:GTIGN,700201,865918060816029,GV53MG,2086,0,0.0,0,90.4,-155.988024,19.818907,20270104011808,0310,0260,A2E4,005EEC0B,,00000:00:50,0.0,20230927193910,18D8$\r\n        GTIGN: 'cmd|ver|key||ignitionOffDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTINF,700100,868487004367421,,11,89882280666032702585,18,0,1,11961,,3.76,1,0,2,-77,20231004053301,0,-104,54,00,00,-13,,20231020142031,B086$\r\n        GTINF: 'cmd|ver|key||temp.status(string)|iccid(string)|rssi(int)|ber(int)|temp.externalPowerSupply(int)|temp.externalPowerVoltage(int)||backupBatteryVoltage(float)|temp.charging(int)|temp.ledOn(int)|||gps.ts(timestamp,20060102150405)||||||tzOffset(string)|tzIsDst(int)|ts(timestamp,20060102150405)|seq',\r\n        GTMPN: '@GTBTC',\r\n        // +RESP:GTMPF,700201,865918060799480,,0,0.0,119,196.3,-89.697145,39.678615,20230407201514,0310,0410,4008,03483D09,,20230407201516,089C$\r\n        GTMPF: '@GTBTC',\r\n        // +RESP:GTPDP,700201,865918060799480,,20230403145628,07C7$\r\n        GTPDP: 'cmd|ver|key||ts(timestamp,20060102150405)|seq',\r\n        GTPFA: '@GTPDP',\r\n        // +RESP:GTPNA,700201,865918060799480,,20230330121416,0782$\r\n        GTPNA: '@GTPDP',\r\n        GTPNL: '@GTDOG',\r\n        // +BUFF:GTLGN,700201,865918060428684,GV53MG,0214,0104,0,,7,20230417183126,00B9$\r\n        GTLGN: 'cmd|ver|key||fwVersion|hwVersion|||rebootReason|ts(timestamp,20060102150405)|seq',\r\n        GTRTL: '@GTDOG',\r\n        // +RESP:GTSTC,700201,865918060799480,,,0,0.0,119,196.3,-89.697145,39.678615,20230407201524,0310,0410,4008,03483D09,,20230407201526,089D$\r\n        GTSTC: 'cmd|ver|key||temp.status|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTSTT,700201,865918060799480,,11,0,0.0,220,198.0,-89.697117,39.678616,20230403144125,0310,0410,4008,03483D09,,20230403144126,07C5$\r\n        GTSTT: '@GTSTC',\r\n        GTTOW: '@GTDOG',\r\n        GTUPC: 'cmd|ver|key||commandId(string)|otaCode(int)|url(string)|ts(timestamp,20060102150405)|seq',\r\n        GTUPD: 'cmd|ver|key||otaCode(int)||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTVER,8A0100,867963063029905,ARMOR4,GV57ARMG,010A,0101,0103,021C,20231211183020,0497$\r\n        // +RESP:GTVER,700100,868487004367421,,GV53MG,011E,0103,20240411032536,0CBC$\r\n        GTVER: 'cmd|ver|key||deviceType|fwVersion|hwVersion|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTVGF,700201,865918060799480,,2,191,0,0.0,220,183.7,-89.696954,39.678708,20230403152236,0310,0410,4008,03483D09,,,0.0,20230403152237,07CC$\r\n        GTVGF: 'cmd|ver|key||temp.virtualIgnitionMode(int)|ignitionOnDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n        GTVGL: '@GTDOG',\r\n        // +BUFF:GTVGN,700201,865918060799480,,2,1764,0,0.0,146,199.8,-89.697048,39.678506,20230329194120,0310,0410,4008,03483D09,,,0.0,20230329201045,0755$\r\n        GTVGN: 'cmd|ver|key||temp.virtualIgnitionMode(int)|ignitionOffDuration(int)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||hourMeter(string)|mileage(float)|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '700201': {\r\n        DeviceType: 'GV53MG',\r\n        BaseVersion: '700100'\r\n    },\r\n    '700600': {\r\n        DeviceType: 'GV53MG',\r\n        BaseVersion: '700100',\r\n        GTVER: 'cmd|ver|key||deviceType|fwVersion|hwVersion|modemHwVersion|modemFwVersion|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '700701': {\r\n        DeviceType: 'GV53MG',\r\n        BaseVersion: '700100',\r\n        GTVER: 'cmd|ver|key||deviceType|fwVersion|hwVersion|modemHwVersion|modemFwVersion|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '8020020700': {\r\n        DeviceType: 'GL33',\r\n        BaseVersion: 'DE0114',\r\n        // +RESP:GTBPL,80200A0100,863756050284101,,3.50,0,,,,,,,0302,0610,2D83,03580700,00,20241205152240,007D$\r\n        GTBPL: 'cmd|ver|key||backupBatteryVoltage(float)|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTBTC,8020020700,865901060554303,,0,0.0,64,44.7,-75.623299,45.432041,20241124033248,,,,,00,20241124153418,0578$\r\n        GTBTC: 'cmd|ver|key||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTNMR,8020020700,865901060554303,,0,0,1,2,1.2,0,46.1,-75.635480,45.448725,20241107005544,0302,0720,3714,8521,00,91,,20241107005544,04B4$\r\n        GTDOG: 'cmd|ver|key||temp.reportId(string)|temp.reportType(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||battery(int)||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTFRI,8020020700,865901060554303,,0,0,1,1,0.5,0,49.8,-75.635442,45.448693,20241107005435,0302,0720,3714,8521,00,91,1C,0,433.00,24.4,20241107005503,04B2$\r\n        GTFRI: 'cmd|ver|key||temp.reportId(string)|temp.reportType(string)||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||battery(int)|temp.reportAppendMask|rfStatus(int)|rfChannelFreq(float)|temperature(float)|ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTGSM,80200A0303,863756050288003,FRI,0310,0410,4005,04328E09,28,,0310,0410,4005,04328E18,28,,0310,0410,4005,04328E0A,27,,,,,,,,,,,,,,,,,,,,0310,0410,4005,0348FD18,99,00,20250305143232,0740$\r\n        GTGSM: 'cmd|ver|key||reason||temp.cell1.mcc|temp.cell1.mnc|temp.cell1.lac|temp.cell1.cellId|temp.cell1.rssi||temp.cell2.mcc|temp.cell2.mnc|temp.cell2.lac|temp.cell2.cellId|temp.cell2.rssi||temp.cell3.mcc|temp.cell3.mnc|temp.cell3.lac|temp.cell3.cellId|temp.cell3.rssi||temp.cell4.mcc|temp.cell4.mnc|temp.cell4.lac|temp.cell4.cellId|temp.cell4.rssi||temp.cell5.mcc|temp.cell5.mnc|temp.cell5.lac|temp.cell5.cellId|temp.cell6.rssi||temp.cell6.mcc|temp.cell6.mnc|temp.cell6.lac|temp.cell6.cellId|temp.cell6.rssi||net.mcc|net.mnc|net.lac|net.cellId|||ts(timestamp,20060102150405)|seq',\r\n        //+RESP:GTINF,8020020700,865901060554303,,41,89882280666087309922,15,0,,,,3.94,0,2,,,20241108180141,,,,+0000,0,20241109114820,04D2$\r\n        GTINF: 'cmd|ver|key||temp.status(string)|iccid(string)|rssi(int)|ber(int)||||backupBatteryVoltage(float)|temp.charging(int)||||gps.ts(timestamp,20060102150405)||||||ts(timestamp,20060102150405)|seq',\r\n        GTNMR: '@GTDOG',\r\n        // +RESP:GTPNA,80200A0100,863756050284101,,20241120072707,007B$\r\n        GTPNA: 'cmd|ver|key||ts(timestamp,20060102150405)|seq',\r\n        GTPDP: '@GTPNA',\r\n        GTPNL: '@GTDOG',\r\n        GTPFL: '@GTDOG',\r\n        // +RESP:GTROF,80200A0303,863756050288003,GL33CG,0,86.4,86,149.1,-83.379985,42.194246,20250209204059,0310,0260,A681,01C9C702,00,20250209221137,04C9$\r\n        GTROF: '@GTDOG',\r\n        GTRON: '@GTDOG',\r\n        GTRTL: '@GTDOG',\r\n        GTSTC: 'cmd|ver|key|||gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTSTT,8020020700,865901060554303,,41,0,0.5,0,49.8,-75.635442,45.448693,20241107005435,0302,0720,3714,8521,00,20241107005543,04B3$\r\n        GTSTT: 'cmd|ver|key||temp.status|gps.accuracy(int)|gps.speed(float)|gps.heading(int)|gps.altitude(float)|gps.longitude(float)|gps.latitude(float)|gps.ts(timestamp,20060102150405)|net.mcc|net.mnc|net.lac|net.cellId||ts(timestamp,20060102150405)|seq',\r\n        // +RESP:GTVER,8020020700,865901060554303,,GL33,0708,0104,20241107024434,04C3$\r\n        GTVER: 'cmd|ver|key||deviceType|fwVersion|hwVersion|ts(timestamp,20060102150405)|seq',\r\n    },\r\n    '80200A0100': {\r\n        DeviceType: 'GL33CG',\r\n        BaseVersion: '8020020700',\r\n    },\r\n    '80200A0200': {\r\n        DeviceType: 'GL33CG',\r\n        BaseVersion: '8020020700',\r\n    },\r\n    '80200A0303': {\r\n        DeviceType: 'GL33CG',\r\n        BaseVersion: '8020020700',\r\n    }\r\n}\r\n\r\nif (!decoders[ver]) {\r\n    log.warn('no version for [' + ver + ']', event.data)\r\n    if (global.values.queclinkConfig.alerts) {\r\n        alert.raise('queclink-alerts', 'queclink-no-version-' + ver, 'no version for [' + ver + ']', 'medium', 'no version for [' + ver + ']', { tags: { type: 'queclink-ascii-protocol' } })\r\n    }\r\n    trigger.exit()\r\n}\r\nvar verDecoder = undefined\r\nvar decoder = undefined\r\nvar nextVer = ver\r\nvar nextCmd = cmd\r\nwhile (1) {\r\n    verDecoder = decoders[nextVer]\r\n    if (verDecoder) {\r\n        decoder = verDecoder[nextCmd]\r\n        if (decoder) {\r\n            if (decoder[0] == '@') {\r\n                nextCmd = decoder.substring(1)\r\n                decoder = undefined\r\n                continue\r\n            } else {\r\n                break\r\n            }\r\n        }\r\n    }\r\n    if (verDecoder.BaseVersion) {\r\n        nextVer = verDecoder.BaseVersion\r\n    } else {\r\n        break\r\n    }\r\n}\r\nif (!decoder) {\r\n    log.warn('no decoder for [' + cmd + ']', event.data)\r\n    if (global.values.queclinkConfig.alerts) {\r\n        alert.raise('queclink-alerts', 'queclink-no-decoder-' + ver + '-' + cmd, 'no decoder for [' + ver + '][' + cmd + ']', 'medium', 'no decoder for [' + ver + '][' + cmd + ']', { tags: { type: 'queclink-ascii-protocol' } })\r\n    }\r\n    trigger.exit()\r\n}\r\n\r\n\r\nobj = convert.delimitedStringToObject(event.data.payload, decoder, ',')\r\nif (obj.temp) {\r\n    if (obj.temp.status) parseStatus(obj.temp.status)\r\n    if (obj.temp.powerOnType) parsePowerOnType(obj.temp.powerOnType)\r\n    if (obj.temp.modeSelection != null) obj.modeSelection = obj.temp.modeSelection == '1' ? 'continuous' : 'PSM'\r\n    if (obj.temp.movementStatus != null) obj.motion = obj.temp.movementStatus == '1'\r\n}\r\nif (obj.rssi) obj.rssi = parseRssi(obj.rssi)\r\nif (obj.externalPowerVcc) obj.externalPowerVcc = obj.externalPowerVcc / 1000.0\r\nif (obj.obd && isNaN(obj.obd.fuelConsumption)) {\r\n    obj.obd.fuelConsumption = 0\r\n}\r\nsetDesc()\r\n\r\nobj.cmd = cmd\r\nobj.buffered = (event.data.payload.substring(1, 5) == 'BUFF')\r\nobj.raw = event.data.payload\r\nobj.deviceType = decoders[ver].DeviceType\r\nobj.remoteAddr = event.data.remoteAddr\r\n\r\nvar details = {}\r\nvar addTags = {\r\n    type: decoders[ver]['DeviceType']\r\n}\r\nvar delTags = []\r\nvar updateNeeded = false\r\n\r\nswitch (cmd) {\r\n    case 'GTASC':\r\n        switch (obj.temp.calibrationStatus) {\r\n            case 1:\r\n                obj.calibrationStatus = 'coarse'\r\n                break\r\n            case 2:\r\n                obj.calibrationStatus = 'fine'\r\n                break\r\n        }\r\n        break\r\n    case 'GTATI':\r\n        addTags['firmware'] = obj.fwVersion\r\n        addTags['firmwareModem'] = obj.modemFwVersion\r\n        if (obj.mcuVersion) {\r\n            addTags['firmwareMcu'] = obj.mcuVersion\r\n        }\r\n        updateNeeded = true\r\n        break\r\n    case 'GTBPL':\r\n        addTags['batteryLow'] = 'true'\r\n        break\r\n    case 'GTCRD':\r\n        if (obj.temp.dataType == 0) {\r\n            obj.dataType = 'before-crash'\r\n        } else {\r\n            obj.dataType = 'after-crash'\r\n        }\r\n        var bin = convert.hexToBin(obj.temp.data)\r\n        var reader = convert.binReader(bin)\r\n        var data = []\r\n        for (var i = 0; i < obj.temp.data.length; i += 12) {\r\n            var point = [reader.readInt16(), reader.readInt16(), reader.readInt16()]\r\n            data.push(point)\r\n        }\r\n        obj.data = data\r\n        break\r\n    case 'GTCRG':\r\n        if (obj.temp.dataType == 0) {\r\n            obj.dataType = 'before-crash'\r\n        } else {\r\n            obj.dataType = 'after-crash'\r\n        }\r\n        break\r\n    case 'GTDIS':\r\n        obj.inputNumber = obj.temp.reportId.charAt(0)\r\n        obj.inputValue = obj.temp.reportId.charAt(1) === '1' ? true : false\r\n        break\r\n    case 'GTFRI':\r\n        switch (ver) {\r\n            case 'DE0114':\r\n                break\r\n            default:\r\n                switch (obj.temp.reportId.charAt(0)) {\r\n                    case '1':\r\n                        obj.reportId = 'time'\r\n                        break\r\n                    case '2':\r\n                        obj.reportId = 'distance'\r\n                        break\r\n                    case '3':\r\n                        obj.reportId = 'mileage'\r\n                        break\r\n                    case '4':\r\n                        obj.reportId = 'time+mileage'\r\n                        break\r\n                    case '5':\r\n                        obj.reportId = 'time~mileage'\r\n                        break\r\n                    case '6':\r\n                        switch (obj.deviceType) {\r\n                            case 'GV500MA':\r\n                                obj.reportId = 'emergency'\r\n                                break\r\n                            default:\r\n                                obj.reportId = 'auto'\r\n                        }\r\n                        break\r\n                    case '7':\r\n                        obj.reportId = 'schedule'\r\n                        break\r\n                    case '8':\r\n                        obj.reportId = 'time~mileage~corner'\r\n                        break\r\n                }\r\n                switch (obj.temp.reportId.charAt(1)) {\r\n                    case '0':\r\n                        obj.reportType = 'normal'\r\n                        break\r\n                    case '1':\r\n                        obj.reportType = 'corner'\r\n                        break\r\n                    case '2':\r\n                        obj.reportType = 'frequency-change'\r\n                        break\r\n                    case '3':\r\n                        obj.reportType = 'frequency-corner'\r\n                        break\r\n                    case '4':\r\n                        obj.reportType = 'mileage'\r\n                        break\r\n                    case '6':\r\n                        obj.reportType = 'mileage-ffc'\r\n                        break\r\n                }\r\n                break\r\n        }\r\n    case 'GTGEO':\r\n        obj.geofenceId = obj.temp.reportId.charAt(0)\r\n        obj.desc += obj.temp.reportId.charAt(1) == '1' ? '-enter' : '-exit'\r\n        break\r\n    case 'GTGSM':\r\n        var cells = []\r\n        if (obj.temp.cell1.mcc.length > 0) {\r\n            cells.push(obj.temp.cell1)\r\n        }\r\n        if (obj.temp.cell2.mcc.length > 0) {\r\n            cells.push(obj.temp.cell2)\r\n        }\r\n        if (obj.temp.cell3.mcc.length > 0) {\r\n            cells.push(obj.temp.cell3)\r\n        }\r\n        if (obj.temp.cell4.mcc.length > 0) {\r\n            cells.push(obj.temp.cell4)\r\n        }\r\n        if (obj.temp.cell5.mcc.length > 0) {\r\n            cells.push(obj.temp.cell5)\r\n        }\r\n        if (obj.temp.cell6.mcc.length > 0) {\r\n            cells.push(obj.temp.cell6)\r\n        }\r\n        if (cells.length > 0) obj.cells = cells\r\n        break\r\n    case 'GTGSS':\r\n        switch (obj.temp.gnssStatus) {\r\n            case 0:\r\n                obj.gnssStatus = 'lost'\r\n                break\r\n            case 1:\r\n                obj.gnssStatus = 'acquired'\r\n                break\r\n        }\r\n        break\r\n    case 'GTHBM':\r\n        obj.harshLevel = obj.temp.reportId.charAt(0)\r\n        obj.harshType = obj.temp.reportId.charAt(1) === '1' ? 'acceleration' : 'braking'\r\n        break\r\n    case 'GTINF':\r\n        if (obj.temp.externalPowerSupply > 0) {\r\n            obj.externalPowerSupply = true\r\n        } else {\r\n            obj.externalPowerSupply = false\r\n        }\r\n        if (obj.temp.charging > 0) {\r\n            obj.charging = true\r\n        } else {\r\n            obj.charging = false\r\n        }\r\n        if (obj.temp.ledOn > 0) {\r\n            obj.ledOn = true\r\n        } else {\r\n            obj.ledOn = false\r\n        }\r\n        if (obj.temp.qcsq) {\r\n            switch (obj.temp.qcsq) {\r\n                case 0:\r\n                    obj.qcsq = 'no-service'\r\n                    break\r\n                case 1:\r\n                    obj.qcsq = 'egprs'\r\n                    break\r\n                case 2:\r\n                    obj.qcsq = 'lte-catm'\r\n                    break\r\n                case 3:\r\n                    obj.qcsq = 'lte-nb2'\r\n                    break\r\n            }\r\n        }\r\n        break\r\n    case 'GTMPN':\r\n        delTags.push('batteryLow')\r\n        break\r\n    case 'GTNMR':\r\n        obj.reportType = obj.temp.reportType == '1' ? 'rest-to-motion' : 'motion-to-rest'\r\n        if (obj.deviceType == 'GL33' || obj.deviceType == 'GL33CG') {\r\n            obj.motion = obj.temp.reportType == '1' ? true : false\r\n        }\r\n        break\r\n    case 'GTVGL':\r\n    case 'GTIGL':\r\n        if (obj.temp.reportId.charAt(1) == '0') {\r\n            obj.ignition = false\r\n        } else {\r\n            obj.ignition = true\r\n        }\r\n        break\r\n    case 'GTTEM':\r\n        var state = 'unknown'\r\n        switch (obj.temp.eventState) {\r\n            case 1:\r\n                state = 'low'\r\n                break\r\n            case 2:\r\n                state = 'high'\r\n                break\r\n            case 3:\r\n                state = 'inside-range'\r\n                break\r\n            case 4:\r\n                state = 'outside-range'\r\n                break\r\n        }\r\n        obj.alarm = { temperature: state }\r\n        break\r\n    case 'GTUPC':\r\n        var ota = parseUpdateCode(obj.otaCode)\r\n        obj.otaStatus = ota.status\r\n        obj.otaDone = ota.terminal\r\n        break\r\n    case 'GTUPD':\r\n        var ota = parseUpdateCode(obj.otaCode)\r\n        obj.otaStatus = ota.status\r\n        obj.otaDone = ota.terminal\r\n        break\r\n    case 'GTVER':\r\n        addTags['firmware'] = obj.fwVersion\r\n        addTags['firmwareModem'] = obj.modemFwVersion\r\n        updateNeeded = true\r\n        break\r\n    case 'GTVGF':\r\n        obj.ignition = false\r\n        break\r\n    case 'GTVGN':\r\n        obj.ignition = true\r\n        break\r\n}\r\n\r\nif (obj.net) {\r\n    try {\r\n        var netData = convert.mccmnc(obj.net.mcc, obj.net.mnc)\r\n        if (netData) {\r\n            addTags.country = netData.country\r\n            addTags.operator = netData.operator\r\n        }\r\n    } catch (e) {\r\n        log.warn('no mcc/mnc for ' + obj.net.mcc + '/' + obj.net.mnc)\r\n        if (global.values.queclinkConfig.alerts) {\r\n            alert.raise('queclink-alerts', 'queclink-no-mccmnc-' + obj.net.mcc + '-' + obj.net.mnc, 'no mcc/mnc for [' + obj.net.mcc + '][' + obj.net.mnc + ']', 'medium', 'no mcc/mnc for [' + obj.net.mcc + '][' + obj.net.mnc + ']', { tags: { type: 'queclink-ascii-protocol' } })\r\n        }\r\n    }\r\n}\r\n\r\nif (obj.iccid) {\r\n    details.iccid = obj.iccid\r\n    updateNeeded = true\r\n}\r\nif (obj.vin) {\r\n    details.vin = obj.vin\r\n    updateNeeded = true\r\n}\r\nif (obj.battery) {\r\n    if (event.endpoint.statusDetails.battery != obj.battery) {\r\n        details.battery = obj.battery\r\n        updateNeeded = true\r\n    }\r\n}\r\n\r\nif (updateNeeded) endpoint.update(event.endpoint.key, { statusDetails: details })\r\n\r\nendpoint.updateTags(event.endpoint.key, addTags, delTags)\r\n\r\nif (!obj.ts) {\r\n    obj.ts = event.ts\r\n}\r\nvar repTs = date.parse(obj.ts, 'rfc3339')\r\nvar evtTs = date.parse(event.ts, 'rfc3339')\r\nif (obj.gps && obj.gps.ts) {\r\n    var gpsTs = date.parse(obj.gps.ts, 'rfc3339')\r\n    obj.gps.age = (repTs - gpsTs) / 1000\r\n}\r\nobj.age = (evtTs - repTs) / 1000\r\n\r\ndelete obj.temp\r\ndelete obj.ignored\r\n\r\nif (global.values.queclinkConfig.debug || event.injected) {\r\n    log.trace('[' + event.endpoint.key + '] ' + cmd + ' received [' + obj.seq + ']', obj)\r\n}\r\n\r\nif (Object.keys(obj).length != 0) {\r\n    exec.now('queclink-data', obj)\r\n}\r\n",
      "filterServiceId": "645e93193855f68ba7567044",
      "filterType": "udp-receive",
      "id": "645e944c3855f68ba756704b",
      "name": "Queclink - ASCII - Core - Receiver",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nvar lastComma = event.data.payload.lastIndexOf(',')\r\n\r\nvar id = event.data.payload.substr(lastComma + 1, 4)\r\nvar cmd = event.data.payload.substring(3, 8)\r\n\r\nvar ack = trigger.wait('queclink:'+event.endpoint.key+':'+id,20)\r\n\r\nexec.now('queclink-sent', {cmd: cmd, raw: event.data.payload, queueOnFailure: false, sentFromQueue: true, source: 'queued-ack'})\r\n\r\nif(ack) {\r\n    log.trace('received queued reply ['+JSON.stringify(ack)+'] from ['+event.endpoint.key+'] for ['+event.data.payload+']')\r\n} else {\r\n    log.trace('timed out waiting for queued reply from ['+event.endpoint.key+'] for ['+event.data.payload+']')\r\n}\r\n",
      "filterServiceId": "645e93193855f68ba7567044",
      "filterType": "udp-queued-packet-flushed",
      "id": "6618236ed182fc7d4058016b",
      "name": "Queclink - ASCII - Core - Receive Queue Acks",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nif(event.endpoint==null) {\r\n    log.warn('no endpoint defined',event.data)\r\n    trigger.reply({error:'no endpoint defined'})\r\n}\r\n\r\nif(!event.endpoint.tags.type) {\r\n    log.warn('no deviceType tag on endpoint',event.data)\r\n    trigger.reply({error:'no type tag on endpoint'})\r\n}\r\n\r\nvar queueOnFailure = true\r\nif(event.data.data.hasOwnProperty('queue')) {\r\n    queueOnFailure = event.data.data.queue\r\n}\r\n\r\nvar sendViaSms = false\r\nif(event.data.data.hasOwnProperty('sms')) {\r\n    sendViaSms = event.data.data.sms\r\n}\r\n\r\nvar ret = { success: false, error: 'unknown'}\r\nswitch(event.data.data.command) {\r\n    case 'rtl':\r\n        args='1,,0,,,120,FFFF$'\r\n        break\r\n    case 'reboot':\r\n        args='3,,0,,,,FFFF$'\r\n        break\r\n    case 'poweroff':\r\n        args='5,,0,,,,FFFF$'\r\n        break\r\n    case 'cid':\r\n        args='6,,0,,,,FFFF$'\r\n        break\r\n    case 'csq':\r\n        args='7,,0,,,,FFFF$'\r\n        break\r\n    case 'ver':\r\n        args='8,,0,,,,FFFF$'\r\n        break\r\n    case 'inf':\r\n        args='F,,0,,,,FFFF$'\r\n        break\r\n    case 'delbuf':\r\n        args='14,,0,,,,FFFF$'\r\n        break\r\n    case 'ati':\r\n        var mask = '00043083'\r\n        switch(event.endpoint.tags.type) {\r\n            case 'GV53MG':\r\n                mask = '00043081'\r\n                break\r\n            case 'GV500MAP':\r\n                mask = '00043087'\r\n                break\r\n            case 'GL502MG':\r\n                mask = '00013091'\r\n                break\r\n        }\r\n        args='1C,'+mask+',0,,,,FFFF$'\r\n        break\r\n    default:\r\n        log.warn('bad command',event.data)\r\n        trigger.reply({success: false, error:'bad command ['+event.data.data.command+']'})\r\n        break\r\n}\r\n\r\nret = exec.sync('queclink-command', {command:'GTRTO', arguments: args, queue: queueOnFailure, sms: sendViaSms})\r\ntrigger.reply(ret)\r\n",
      "filterGeneric": "queclink-rto-command",
      "filterType": "generic",
      "genericSample": "{\n  \"form\": true,\n   \"title\": \"Send RTO command\",\n   \"desc\": \"Send an RTO command to the device\",\n   \"icon\": \"mdi-camera-control\",\n   \"endpoint\":{ \"required\": true },\n   \"fields\": [\n      { \"name\": \"Command\", \"key\": \"command\", \"type\": \"option\", \"options\": [ \"rtl\", \"reboot\", \"poweroff\", \"cid\", \"csq\", \"ver\", \"inf\", \"delbuf\", \"ati\" ] },\n      {\"name\":\"Queue on failure\", \"key\":\"queue\", \"type\":\"bool\"},\n      {\"name\":\"Send via SMS\", \"key\":\"sms\", \"type\":\"bool\"}\n   ]\n}",
      "id": "660315cdf5c83a4ee862b6d5",
      "name": "Queclink - ASCII - Command Handler - RTO",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nif(event.endpoint==null) {\r\n    log.warn('no endpoint defined')\r\n    trigger.reply({error:'no endpoint defined'})\r\n}\r\n\r\nvar sms = event.data.data.sms?true:false\r\n\r\nif(sms && !event.endpoint.statusDetails.iccid) {\r\n    log.warn('fota via sms, but no iccid for endpoint',event.data)\r\n    trigger.reply({error:'no iccid for endpoint'})\r\n}\r\n\r\nif(!trigger.ratelimit('fota:'+event.endpoint.key,1,1,120)) {\r\n    trigger.exit()\r\n}\r\n\r\nif(event.data.data.type==\"reset\") {\r\n    cache.del('fota:'+event.endpoint.key)\r\n    log.trace('['+event.endpoint.key+'] fota reset')\r\n    trigger.exit()\r\n}\r\n\r\nif(!event.data.data.type && event.endpoint.tags.fotaAutoUpgrade) {\r\n    if(event.endpoint.tags.fotaAutoUpgrade!=='true') {\r\n        trigger.exit()\r\n    }\r\n}\r\n\r\nvar fotaObj = cache.get2('fota:'+event.endpoint.key)\r\nif(fotaObj && fotaObj.inProgress) {\r\n    log.warn('['+event.endpoint.key+'] fota in progress, cant start new one', fotaObj)\r\n    exec.now('queclink-fota-rejected', {reason:'fota already in progress', details: fotaObj})\r\n    trigger.exit()\r\n}\r\n\r\nvar fota = global.values.queclinkFota\r\nvar dfota = fota[event.endpoint.tags.type]\r\n\r\nif(!dfota) {\r\n    log.warn('no ['+event.endpoint.tags.type+'] defined')\r\n    trigger.exit()\r\n}\r\n\r\nfunction getUrl(vtype, ver) {\r\n    var url = ''\r\n    if(ver.fileKey) {\r\n        var nextVer = ver.version\r\n        if(ver.fileVersion) {\r\n            nextVer = ver.fileVersion\r\n        }\r\n        if(event.data.data.version)  {\r\n            nextVer = event.data.data.version\r\n        }\r\n        var fi = file.info(ver.fileKey, nextVer)\r\n        if(fi && fi.requestedVersion) {\r\n            log.trace('['+event.endpoint.key+'] fota '+vtype+' version info for: '+nextVer, fi)\r\n            url = fi.requestedVersion.downloadUrl.replace('https', 'http')\r\n        } else {\r\n            log.warn('['+event.endpoint.key+'] fota '+vtype+' file version not available', {fileKey: ver.fileKey, version: ver.version, fileVersion: ver.fileVersion})\r\n            trigger.exit()\r\n        }\r\n    } else if(ver.url) {\r\n        url = ver.url\r\n    } else {\r\n        log.warn('['+event.endpoint.key+'] fota '+vtype+' url not available')\r\n        trigger.exit()\r\n    }\r\n    return url\r\n}\r\n\r\nfunction setStart(vtype, have, want) {\r\n    fotaObj = { \r\n        id: date.format(event.ts,vtype+'-060102-150405'),\r\n        inProgress: false,\r\n        have: have,\r\n        want: want,\r\n        subsystem: vtype,\r\n        started: event.ts,\r\n    }\r\n    if(event.endpoint.tags.configTarget && dfota.postUpdateConfigTarget) {\r\n        var targetConfig = dfota.postUpdateConfigTarget[event.endpoint.tags.configTarget]\r\n        if(targetConfig) {\r\n            fotaObj.configTargetOnSuccess = targetConfig\r\n        }\r\n    }\r\n    endpoint.updateTags(event.endpoint.key,{fotaNeeded:vtype})\r\n    cache.set2('fota:'+event.endpoint.key,fotaObj,3600)\r\n    exec.now('queclink-fota-initiated', {details: fotaObj})\r\n    report.publish('queclink-fota-results',event.endpoint.key+'-'+fotaObj.id,event.ts,{name: event.endpoint.name, endpointId: event.endpoint.id, values:{started: event.ts, subsystem: vtype, status: 'initiated', have: have, want: want}})\r\n}\r\n\r\n// The code below controls the order of updates, it will update completely each section before moving onto the next.\r\nif(event.data.data.type=='modem' ||\r\n        (!event.data.data.type && event.endpoint.tags.firmwareModem && dfota.modem && dfota.modem[event.endpoint.tags.firmwareModem])) {\r\n    if(event.endpoint.tags.firmwareModem!=dfota.modem[event.endpoint.tags.firmwareModem].version) {\r\n        var targetVersion = dfota.modem[event.endpoint.tags.firmwareModem].version\r\n        if(event.data.data.version) {\r\n            targetVersion = event.data.data.version\r\n        }\r\n        log.trace('['+event.endpoint.key+'] fota modem mismatch: have ['+event.endpoint.tags.firmwareModem + '], want ['+targetVersion+']')\r\n        var url = getUrl('modem', dfota.modem[event.endpoint.tags.firmwareModem])\r\n        var args = '0,0,20,0,,,'+url+',,7,0,00000000,FFFF$'\r\n        setStart('modem', event.endpoint.tags.firmwareModem, targetVersion)\r\n        exec.now('queclink-command', {command:'GTUPD', arguments: args, sms: sms, queue: true})\r\n        trigger.exit()\r\n    }\r\n}\r\n\r\nif(event.data.data.type=='bb' ||\r\n        (!event.data.data.type && event.endpoint.tags.firmware && event.endpoint.tags.firmware!=dfota.bb.version)) {\r\n    var targetVersion = dfota.bb.version\r\n    if(event.data.data.version) {\r\n        targetVersion = event.data.data.version\r\n    }\r\n    log.trace('['+event.endpoint.key+'] fota bb mismatch: have ['+event.endpoint.tags.firmware + '], want ['+targetVersion+']')\r\n    var url = getUrl('bb', dfota.bb)\r\n    var args = '0,0,20,0,,,'+url+',,0,0,00000000,FFFF$'\r\n    setStart('bb', event.endpoint.tags.firmware, targetVersion)\r\n    exec.now('queclink-command', {command:'GTUPD', arguments: args, sms: sms, queue: true})\r\n    trigger.exit()\r\n}\r\n\r\nif(event.data.data.type=='mcu' ||\r\n        (!event.data.data.type && event.endpoint.tags.firmwareMcu && event.endpoint.tags.firmwareMcu!=dfota.mcu.version)) {\r\n    var targetVersion = dfota.mcu.version\r\n    if(event.data.data.version) {\r\n        targetVersion = event.data.data.version\r\n    }\r\n    log.trace('['+event.endpoint.key+'] fota mcu mismatch: have ['+event.endpoint.tags.firmwareMcu + '], want ['+targetVersion+']')\r\n    var url = getUrl('mcu', dfota.mcu)\r\n    var args = '0,0,20,0,,,'+url+',,1,0,00000000,FFFF$'\r\n    setStart('mcu', event.endpoint.tags.firmwareMcu,targetVersion )\r\n    exec.now('queclink-command', {command:'GTUPD', arguments: args, sms: sms, queue: true})\r\n    trigger.exit()\r\n}\r\n\r\nif(event.endpoint.tags.fotaNeeded) {\r\n    endpoint.updateTags(event.endpoint.key,null,['fotaNeeded'])\r\n}",
      "filterCustom": {
        "has-tag:type": {
          "comp": "has-tag",
          "value": "type"
        }
      },
      "filterGeneric": "queclink-fota-command",
      "filterType": "generic",
      "genericSample": "{\n  \"form\": true,\n   \"title\": \"Send FOTA command\",\n   \"desc\": \"Send an FOTA command to the device\",\n   \"icon\": \"mdi-download-box\",\n   \"endpoint\":{ \"required\": true },\n   \"fields\": [\n      { \"name\": \"Type\", \"key\": \"type\", \"type\": \"option\", \"options\": [ \"bb\", \"mcu\", \"modem\" , \"auto\"] },\n      { \"name\": \"Version\", \"key\": \"version\", \"type\": \"string\" }\n   ]\n}",
      "id": "665dd0090df24921fe0f3096",
      "name": "Queclink - ASCII - Command Handler - FOTA",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nif (event.endpoint == null) {\r\n    log.warn('no endpoint defined')\r\n    trigger.reply({ error: 'no endpoint defined' })\r\n}\r\n\r\nif (!event.endpoint.tags.configTarget) {\r\n    log.warn('[' + event.endpoint.key + '] no config target defined')\r\n    trigger.reply({ error: 'no config target defined' })\r\n}\r\n\r\nif (!trigger.ratelimit('cota:' + event.endpoint.key, 1, 1, 300)) {\r\n    trigger.exit()\r\n}\r\n\r\nvar deviceType = event.endpoint.tags.type\r\nvar target = event.endpoint.tags.configTarget\r\n\r\nvar fi = file.info(target, 'default')\r\nif (!fi || !fi.requestedVersion) {\r\n    log.warn('[' + event.endpoint.key + '] cota file not available')\r\n    if (global.values.queclinkConfig.alerts) {\r\n        alert.raise('queclink-alerts', 'queclink-no-cota-file-' + target, 'no cota file for [' + target + ']', 'medium', 'no cota file for [' + target + ']', { tags: { type: 'queclink-cota' } })\r\n    }\r\n    trigger.exit()\r\n}\r\nif (event.data.data.forceUpdate === true) {\r\n    // bypass matching logic\r\n} else if (event.endpoint.statusDetails && event.endpoint.statusDetails.configHash === fi.requestedVersion.hash) {\r\n    if (global.values.queclinkConfig.debug) {\r\n        log.trace('[' + event.endpoint.key + '] cota matched, ignoring')\r\n    }\r\n    trigger.exit()\r\n}\r\n\r\nvar url = fi.requestedVersion.downloadUrl.replace('https', 'http')\r\n\r\nif (global.values.queclinkConfig.debug) {\r\n    log.trace('[' + event.endpoint.key + '] cota being applied', { url: url })\r\n}\r\n\r\n\r\nvar statusDetails = { configStatus: 'started', configPendingHash: fi.requestedVersion.hash, configPendingVersion: '' + fi.requestedVersion.version }\r\nendpoint.update(event.endpoint.key, { statusDetails: statusDetails, addTags: { configNeeded: 'true' } })\r\n\r\nvar args = '0,10,0,1,0,' + url + ',1,00,0,00000000,,3,FFFF$'\r\nexec.now('queclink-command', { command: 'GTUPC', arguments: args, queue: true })\r\n",
      "filterGeneric": "queclink-cota-command",
      "filterType": "generic",
      "genericSample": "{\n  \"form\": true,\n   \"title\": \"Send COTA command\",\n   \"desc\": \"Send an COTA command to the device\",\n   \"icon\": \"mdi-cog-outline\",\n   \"endpoint\":{ \"required\": true },\n   \"fields\": [\n    {\"name\": \"Force update\", \"key\":\"forceUpdate\", \"type\":\"bool\"}\n   ]\n}",
      "id": "665dd0090df24921fe0f3097",
      "name": "Queclink - ASCII - Command Handler - COTA",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    },
    {
      "def": "\r\nif (event.endpoint == null) {\r\n    log.warn('no endpoint defined', event.data)\r\n    trigger.reply({ error: 'no endpoint defined' })\r\n    endpoint.search('key==\"' + event.data.data.key + '\"', searchCallback)\r\n}\r\n\r\nfunction send_raw_command(key, password, command, params, queueOnFailure) {\r\n    var id = random.hex(4)\r\n\r\n    if (params.endsWith('$')) {\r\n        var lastComma = params.lastIndexOf(',')\r\n        params = params.substr(0, lastComma + 1)\r\n        //log.trace('trimmed command to: '+command)\r\n    }\r\n\r\n    var fullCommand = 'AT+' + command + '=' + password + ',' + params + id + '$'\r\n    log.trace('sent command [' + fullCommand + '] to [' + key + ']')\r\n\r\n    var sendViaSms = false\r\n    if (event.data.data.hasOwnProperty('sms')) {\r\n        sendViaSms = event.data.data.sms\r\n    }\r\n\r\n    exec.now('queclink-sent', { cmd: command, params: params, raw: fullCommand, queueOnFailure: queueOnFailure, sentFromQueue: false, source: 'trigger', transport: sendViaSms ? 'sms' : 'udp' })\r\n\r\n    if (sendViaSms) {\r\n        exec.now('queclink-sms-handler', { command: fullCommand })\r\n    } else {\r\n        udp.send('', key, fullCommand)\r\n    }\r\n\r\n    var ack = trigger.wait('queclink:' + key + ':' + id, 10)\r\n\r\n    if (ack) {\r\n        log.trace('received reply [' + ack.packet + '] from [' + key + '] for [' + fullCommand + ']', ack)\r\n        return { success: true }\r\n    } else {\r\n        log.trace('timed out waiting for reply from [' + key + '] for [' + fullCommand + ']')\r\n        if (queueOnFailure) {\r\n            //log.trace('queued', ack)\r\n            udp.queue('', key, command, fullCommand, 86400)\r\n        }\r\n        return { success: false, error: 'timeout' }\r\n    }\r\n}\r\n\r\nif (!event.endpoint.tags.type) {\r\n    log.warn('no deviceType tag on endpoint', event.data)\r\n    trigger.reply({ error: 'no type tag on endpoint' })\r\n}\r\n\r\nvar password = ''\r\nif (event.endpoint.statusDetails && event.endpoint.statusDetails.password) {\r\n    password = event.endpoint.statusDetails.password\r\n} else if (global.values.queclinkPasswords) {\r\n    if (global.values.queclinkPasswords[event.endpoint.tags.type]) {\r\n        password = global.values.queclinkPasswords[event.endpoint.tags.type]\r\n    }\r\n}\r\nif (password.length == 0) {\r\n    log.warn('no password available', event.data)\r\n    if (global.values.queclinkConfig.alerts) {\r\n        alert.raise('queclink-alerts', 'no-password-' + event.endpoint.tags.type.toLowerCase(), 'No password for type ' + event.endpoint.tags.type, 'medium', 'No password is available.')\r\n    }\r\n    trigger.reply({ error: 'no password available' })\r\n}\r\n\r\nvar queueOnFailure = false\r\nif (event.data.data.hasOwnProperty('queue')) {\r\n    queueOnFailure = event.data.data.queue\r\n}\r\n\r\nsend_raw_command(event.endpoint.key, password, event.data.data.command, event.data.data.arguments, queueOnFailure)\r\ntrigger.reply({ success: true })\r\n",
      "filterGeneric": "queclink-command",
      "filterType": "generic",
      "genericSample": "{\n  \"form\": true,\n   \"title\": \"Send command\",\n   \"desc\": \"Send a command to the device\",\n   \"icon\": \"mdi-camera-control\",\n   \"endpoint\":{ \"required\": true },\n   \"fields\": [\n      { \"name\": \"Command\", \"key\": \"command\", \"type\": \"string\" },\n      { \"name\": \"Arguments\", \"key\": \"arguments\", \"type\": \"string\"},\n      {\"name\":\"Queue on failure\", \"key\":\"queue\", \"type\":\"bool\"},\n      {\"name\":\"Send with SMS\", \"key\":\"sms\", \"type\":\"bool\"},\n   ]\n}",
      "id": "665dd0090df24921fe0f3098",
      "name": "Queclink - ASCII - Command Handler",
      "rateLimit": {
        "scope": "none",
        "unit": "minute"
      },
      "type": "script"
    }
  ],
  "reports": [
    {
      "fields": [
        {
          "aggregations": [
            {
              "name": "Battery Level",
              "range": [
                {
                  "key": "low",
                  "to": 20
                },
                {
                  "key": "ok",
                  "to": 50
                },
                {
                  "key": "good",
                  "to": 80
                },
                {
                  "key": "great",
                  "to": 101
                }
              ],
              "type": "range"
            }
          ],
          "hidden": false,
          "key": "battery",
          "name": "Battery",
          "required": false,
          "type": "number"
        }
      ],
      "id": "65295831ae4a2630c78e4e8f",
      "key": "queclink-battery",
      "name": "Queclink Battery Report",
      "operations": [],
      "options": null,
      "records": 0
    },
    {
      "fields": [
        {
          "aggregations": [
            {
              "name": "New aggregation",
              "type": ""
            }
          ],
          "hidden": false,
          "key": "subsystem",
          "name": "Subsystem",
          "required": false,
          "type": "string"
        },
        {
          "aggregations": [
            {
              "name": "Results",
              "type": "terms"
            },
            {
              "name": "Results by Subsystem",
              "pivot": "subsystem",
              "type": "terms"
            }
          ],
          "hidden": false,
          "key": "result",
          "name": "Result",
          "required": false,
          "type": "string"
        },
        {
          "hidden": true,
          "key": "started",
          "name": "started",
          "required": false,
          "type": "string"
        },
        {
          "hidden": true,
          "key": "status",
          "name": "status",
          "required": false,
          "type": "string"
        },
        {
          "hidden": true,
          "key": "want",
          "name": "want",
          "required": false,
          "type": "string"
        },
        {
          "hidden": true,
          "key": "have",
          "name": "have",
          "required": false,
          "type": "string"
        }
      ],
      "id": "664f978693dd483c3f485115",
      "key": "queclink-fota-results",
      "name": "Queclink FOTA Results",
      "operations": [],
      "options": {
        "lookupEndpointsByKey": false
      },
      "records": 0
    },
    {
      "fields": [
        {
          "hidden": false,
          "key": "version",
          "name": "Version",
          "required": false,
          "type": "string"
        },
        {
          "hidden": false,
          "key": "command",
          "name": "Command",
          "required": false,
          "type": "string"
        },
        {
          "hidden": false,
          "key": "sample",
          "name": "Sample",
          "required": false,
          "type": "string"
        }
      ],
      "id": "64da92708af95a1777304711",
      "key": "queclink-sampler",
      "name": "Queclink Message Sampler",
      "operations": [],
      "options": null,
      "records": 0
    }
  ]
}